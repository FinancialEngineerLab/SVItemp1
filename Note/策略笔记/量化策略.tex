%\documentclass[CCT]{ctexart}
%\documentclass[CJK]{cctart}
\documentclass[CCT]{ctexart}
\usepackage{indentfirst}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{float}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{enumerate}
\usepackage{algorithm}
\usepackage{color}
\usepackage{algpseudocode}
\usepackage{graphics}
\usepackage{epsfig}
\usepackage{bbm}

\renewcommand{\algorithmicrequire}{\textbf{Initialization:}} % Use Input in the format of Algorithm
\renewcommand{\algorithmicensure}{\textbf{Iteration:}} % Use Output in the format of Algorithm


\newtheorem{theorem}{Theorem}
\input bnp-macro
\usepackage{geometry}   %设置页边距的宏包
\newtheorem{proposition}[theorem]{Proposition}

\geometry{left=4cm,right=0.3cm,top=4cm,bottom=2cm}  % 设置 上、左、下、右 页边距
\usepackage{pgf, tikz}

\begin{document}
\title{嘉合基金量化研究与策略}

\author{嘉合量化投资部}
%\date{2014.12}
%\version{2015.4}
\maketitle
\tableofcontents
\newpage

\section{量化选股策略}
\subsection{行业中性策略}
\subsubsection{概述}
行业中性策略是一种$\a$策略，在给定有$N$ 只股票的股票池中，选择出$N^{*}$只股票，这一选择出的股票组合的行业权重与沪深300 指数中的各行业权 重一致，但是每个行业选择的股票与沪深300 指数不同（以中小板股票为主），以期获得超额收益。

\subsubsection{算法}
在给定的股票池内，首先根据预先设置的指标对这些股票对各项指标打分（分数为升序或者降序排列的序列位置），然后加权汇总成总分，按照\textbf{升序}排列。打分的指标和权重如下

\begin{itemize}
\item 净利润预期增长率, 权重 20\%。 按照\textbf{降序}排列。此比例为年报预期净利润与年报净利润的差除以年报净利润（绝对值）。假设测试时点在$T$ 年，如果测试时点在5 月以前，则使用$T-2$ 年年报净利润 和 $T$ 年预期净利润作为比较数值，因为$T-1$ 年（即去年）的年报数据尚未公布。如果在5 月以后，则使用$T-1$ 年年报净利润 和 $T+1$ 年预期净利润作为比较数值。

\item 市盈率（PE）， 权重 30\%。 按照调整后的市盈率\textbf{升序}排列。用$\PE_{i}$，$\PE^{*}_{i}$来表示第$i$ 只股票调整前后的PE 值，假设 $\PE^{H} = \max\limits_{i \le N}\{\PE_{i} \}$，$\PE^{L} = \min\limits_{i \le N}\{\PE_{i} \}$。 调整规则为
\begin{eqnarray*}
\PE^{*}_{i} = \begin{cases}
\PE_{i}& {\PE^{L} >0 }\\
\PE_{i}& {\PE^{L} \le 0,\PE_{i}> 0 }\\
\PE^{H} +1+ \vert\PE^{L}\vert +\PE_{i} & {\PE^{L} \le 0,\PE_{i}\le 0}
\end{cases}
\end{eqnarray*}

\item 净资产收益率（ROE），权重 20\%。 按照\textbf{升序}排列。如果ROE 出现负值，则按照调整指标来排序。 假设股票池有$N$ 只股票，用$\ROE_{i}$，$\ROE^{*}_{i}$来表示第$i$ 只股票调整前后的ROE 值，假设 $\ROE^{H} = \max\limits_{i \le N}\{\ROE_{i} \}$，$\ROE^{L} = \min\limits_{i \le N}\{\ROE_{i} \}$。 调整规则为
\begin{eqnarray*}
\ROE^{*}_{i} = \begin{cases}
\ROE_{i}& {\ROE^{L} >0 }\\
\ROE_{i}& {\ROE^{L} \le 0,\ROE_{i}> 0 }\\
\ROE^{H} +1 -\ROE_{i} & {\ROE^{L} \le 0,\ROE_{i}\le 0}
\end{cases}
\end{eqnarray*}
\item 三个月反转率， 权重 20\%。 按照过去三个月内股票涨幅百分比\textbf{升序}排列，去除掉每月交易日不足16 天的股票
\item 流通市值，权重 10\%。 按照计算日当日市值\textbf{升序}排列。
\end{itemize}

同时，提取出当日（调仓日）沪深300 指数的成分股，权重以及相应行业（按照申万一级行业分类）。对于任意一个沪深300 的行业$i$，从总排序的股票池中挑选出属于这一行业打分属于前$N_{i}^{*}$的股票，遍历所有行业后，把选择的股票加总便构成了总的组合。针对任意行业$i$ 挑选个股的方法如下。

假设第$i$个行业在沪深300中权重为$\omega_{\HS,i}$, 该行业应该选择出股票池行业内前$N^{*}_{i}$ 只股票
\begin{eqnarray*}
N^{*}_{i} = \begin{cases}
\min \left(0.01\omega_{\HS,i}N^{*},1\right) & i \neq i_{finance}  \\
\min \left( \min \left(0.01\omega_{\HS,i}N^{*},1\right),5 \right) & i = i_{finance} \\
\end{cases}
\end{eqnarray*}
$i_{finance}$是指申万金融服务和申万银行两个行业。这两个行业的股票相对较少，但是权重较大，所以设置上限为5 只。选择出的$N^{*}_{i}$ 只股票等权重分布，即行业$i$ 中的任意股票权重均为$\frac{\omega_{\HS,i}}{N^{*}_{i}}$.\footnote{由于在沪深300 指数中去除了停牌的情况，可能最后挑选出的股票组合权重不到100\%, 此时将组合各个股票的权重重新规范化即可}

按照以上选股规则，定期对组合进行调仓。周期默认为2 个月。

\subsubsection{策略回测}
该策略的回测显示了较好的超额收益。

%\begin{figure}
%\centering
%\scalebox{0.65}{\includegraphics{IndustryNeutralResult.jpg}}
%\caption{行业中性策略回测收益率}
%\label{IndustryNeutral}
%\end{figure}


\subsection{一季报策略}
\subsubsection{概述}
一季报\footnote{上市公司通常在4月最后一周披露}策略是一种事件驱动型$\a$策略。该策略通过对披露的一季报数据，结合基本面因子进行选股，以期获得超额收益。

\subsubsection{算法}
在给定的股票池内，当任意上市公司的一季报公布后，立即根据预先设置的指标对这些股票筛选，如果符合要求，则随后第一个交易日开盘买入并持有20个交易日。

相关指标和筛选标准如下
\begin{itemize}
\item 第一季度营业收入增长率以及净利润增长率增长率均大于$1\%$
\item 总收入环比增长率和利润环比增长率均大于$1\%$\footnote{环比增长率是指第一季度与上一季度数据相比}
\item 第一季度$\ROE$ 大于$0.5\%$\footnote{以上数据取自天软数据库，使用函数\textbf{reporttofall}}
\item 分析师一致评级大于$0.7$。评级数据为0-1之间的数。
\item 分析师近13周一致预期环比变化率大于$0$\footnote{该数据取自朝阳永续数据库}
\item 事件日超额收益率大于$2\%$。事件日是指一季报披露日，超额收益率是指针对指数的超额收益率
\end{itemize}


\subsubsection{策略回测}
在全市场范围内应用此策略能选择出约70只股票，持有20天的平均超额收益约$4\%$。



\subsection{PEAD策略}
\subsubsection{概述}
\label{SUE}
PEAD是英文Post Earnings Announcement Drift 的缩写，中文叫盈余公告后漂移现象，也叫盈余惯性，指未预期盈余较高的公司在未来一段时期内的市场回报会显著地高于那些未预期盈余较低的公司。

嘉合PEAD策略是一种事件驱动型$\a$策略，在给定有$N$ 只股票的股票池中，根据季报或者年报公告的漂移率筛选出$N^{*}$ 只股票，期望获得超额收益的策略。

\subsubsection{算法}

PEAD策略建仓时间是在盈利公布日（年报或者季报）第二天。对于股票$i$,假设公告日时间为$T_{i}$(年或者季度）, 上一公告日为$T_{i}-1$。

首先，对$T_{i}-1$时刻公布的标准预期外利润（Standard Unexpected Earnings, 简称SUE) 进行排序\textbf{降序}拍了，并分成10 档，得到10个分位数。$\SUE_{i,T_{i}-1}$ 表示股票$i$ 在$T_{i}-1$ 时刻的标准预期外净利润， 即$T_{i}-1$ 期公告净利润与$T_{i}-2$ 期公告净利润的差除以该股票$i$ 当时总市值。${\SUE_{q,T_{i}-1},q=10\%,20\%...100\%}$ 表示根据$T_{i}-1$时刻的$\SUE$值算出的10 个分位数。

然后，对刚刚得到的$T$时刻的所有股票，先去除掉当日涨停的股票，，然后按照$\SUE_{i,T_{i}}$ 进行排序分组，分组的上下限使用$T-1$ 时刻的分位数${\SUE_{q,T_{i}-1},q=10\%,20\%...100\%}$
。


\subsubsection{策略回测}
经测试，PEAD策略的一季报策略保持有较好的超额收益，但是年报策略却没有稳定的超额收益。

PEAD策略的最终回测假设持有期为20天，使用的是每年第一季度季报的$\SUE$数据。过去两年的回测摘要结果如下。
\begin{center}
\begin{tabular}{|c|c|c|}

\hline
回测时点 & 2013-03-31& 2014-03-31 \\
\hline
第一组超额收益均值& 4.63& 3.78\%\\
\hline
第二组超额收益均值& 6.03& 2.87\%\\
\hline
第三组超额收益均值& 8.24& 1.67\%\\
\hline
第一组样本数& 340& 208\\
\hline
第二组样本数& 291& 205\\
\hline
第三组样本数& 241& 218\\
\hline
\end{tabular}



\end{center}

\subsection{一季报PEAD策略}
\subsubsection{概述}
该策略是一季报策略的基础上加上了PEAD的因子(即$\SUE$和$\SUV$)的事件驱动型$\a$ 策略。$\SUE$ 的定义见章节(\ref{SUE})。$\SUV$是指财报公布后的标准预期外成交量（Standard Unexpected Volume, 简称SUV)。

\subsubsection{算法}
在给定的股票池内，当任意上市公司的一季报公布后，立即根据预先设置的指标对这些股票百分法打分降序排序，挑选出各项指标均达到阈值的股票，在5月第一个交易日全部买入，持有60 个交易日。



该策略的相关指标和筛选标准如下
\begin{itemize}
\item 一季报公布日当天的$\SUV$在前$50\%$，此处用$\SUV_{0}$表示。其计算方法为
\begin{eqnarray*}
\SUV_{0} = \begin{cases}
\frac{V_{0}-(a+b_{1}R^{u}_{0})}{SS}\\
\frac{V_{0}-(a-b_{2}R^{d}_{0})}{SS}\\
\end{cases}
\end{eqnarray*}


其中$V_{0}$，$R^{u}_{0}$,$R^{d}_{0}$表示公布日当天股票的交易量以及涨跌幅（为绝对值）。另外$a$,$b_{1}$,$b_{2}$和$SS$来自于回归方程
\begin{eqnarray*}
V_{t} = a+b_{1}R^{u}_{t-1}+b_{2}R^{d}_{t-1}+\e
\end{eqnarray*}

$R^{u}_{t}$表示$t$时刻股票涨幅，$R^{d}_{t}$ 表示$t$时刻股票跌幅\footnote{二者为互斥关系，任意时刻其中一个为零，另一个为非零。}。$SS$为回归方程的日均回归平方和（即$SSR$除以回归数据的天数).
此处使用公布日前54个交易日至前5个交易日间的量价数据.



\item 一季报公布日后的首个交易日的$\SUV$ 在前$50\%$，此处用$\SUV_{1}$表示。计算方法与$\SUV_{0}$相同
\item 一季报公布日的$\SUE$在前$50\%$。$\SUE$计算方法为当日公布的当期净利润减去上年同期净利润，再除以公布日市值
\item 相对于60个交易日前价格，分析师目标价上调幅度前$50\%$
\item 分析师评级上调幅度在前$70\%$。评级数据为0-1之间的数。
\item 分析师近4周一致预期环比变化率在前$50\%$
\item 分析师近13周一致预期环比变化率在前$50\%$\footnote{该数据取自朝阳永续数据库}
\item 事件日超额收益率大于$0\%$。事件日是指一季报披露日，超额收益率是指针对指数的超额收益率
\end{itemize}


此策略筛选的主要逻辑是，利用市场对业绩利好事件的反应不足，构建组合获取盈余漂移的收益。衡量标准为业绩较好（事件日超额收益为正，$SUE$排名靠前），市场分歧较大（事件当日、次日的$SUV$ 靠前），
随后分析师逐步上调评级（目标价、评级、盈利预测），市场可能逐步认识到该利好。

\subsubsection{策略回测}
在全市场范围内应用此策略能选择出约60-70只股票，持有60日的平均超额收益约$8\%$，中值约$10\%$。

另外此模型也适用于其他季报。

\subsection{分红策略}
\subsubsection{概述}

分红策略是一种$\a$策略。

\subsection{年报业绩快报策略}
\subsubsection{概述}
该策略通过对公司披露的业绩快报数据，结合朝阳永续数据库中分析师一致预期数据进行筛选，持有一段时间以期获得超额收益的策略。

\subsubsection{算法}
本策略的股票池为在全市场的股票中，当任意上市公司的年报业绩快报公布后，根据预先设置的下列指标对这些股票筛选，如果符合要求，则随后第一个交易日开盘买入并持有20个交易日。

相关指标和筛选标准如下：
\begin{itemize}
\item 公司年报净资产收益率（加权）即ROE大于$2\%$
\item 公司年报营业收入同比、环比增长率大于$0\%$
\item 公司年报净利润同比、环比增长率大于$5\%$
\item 公司业绩超预期幅度大于$-5\%$\footnote{该数据取自朝阳永续数据库，通过净利润同比增长率减去一致预期净利同比求得}
\item 分析师近4周一致预期上调幅度大于$-5\%$\footnote{该数据取自朝阳永续数据库}
\end{itemize}


\subsection{业绩预警策略}
\subsubsection{概述}
该策略通过对公司披露的年报的业绩预警公告(也叫业绩预告，主要在每年1月，年报主要在一季度末)，结合朝阳永续数据库中分析师一致预期数据进行筛选，持有一段时间以期获得超额收益的策略。

\subsubsection{算法}
本策略的股票池为在全市场的股票中，当任意上市公司的年报业绩预告公布后，根据预先设置的下列指标对这些股票筛选，如果符合要求，则随后第一个交易日开盘买入并持有20个交易日。


\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[
假设预告公布日 = 2016-12-25， 涉及到的相关日期为

上一报告期 = 2015-09-30
去年同期报告期 = 2014-12-31
一致预期数据日 = 预告公布日前一交易日

]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont





相关指标和筛选标准如下：
\begin{itemize}
\item 预告公布日前20日停牌天数小亍等亍5天的
\item 预告类型为略增、扭亏、续盈、预增的
\item 90日内有卖方分析师一致预期数据的(报告数大于零)
\item 整体超预期幅度范围在$10\%$至$100\%$

\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[
整体超预期幅度 = (预告净利润下限(万元) - 一致预期归属母公司净利润)/$|$一致预期归属母公司净利润$|$ *100

数据来自朝阳永续，选择读取日期为一致预期数据日，其中
\begin{itemize}
\item 预告净利润下限 = 预告净利润同比增长下限($\%$)/100*$|$上年同期净利润$|$
\item 预告净利润上限 = 预告净利润同比增长上限($\%$)/100*$|$上年同期净利润$|$
\end{itemize}
]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont


\item 未公布超预期幅度大亍0


\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[
未公布超预期幅度 = (预告净利润下限(万元) - 一致预期归属母公司净利润)/$|$一致预期归属母公司净利润-上一季度净利润$|$ *100

数据来自朝阳永续，\emph{上一季度净利润}的选择读取日期为上一报告日，其他数据为一致预期数据日
]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont

\item 预告净利润同比增长下限大于0
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[
数据来自朝阳永续，选择读取日期一致预期数据日
]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont


\item 未知盈利金额增长下限大于0


\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[
预告净利润下限(万元)= 预告净利润同比增长下限($\%$)/ $|$上年同期净利润$|$*100 + 上年同期净利润

未知预告净利润下限(万元) = 预告净利润下限(万元) - 上一季度净利润 (如果报告日所在为第一季度，则不需要减去这一项)

未知盈利金额增长下限 = (未知预告净利润下限(万元) - 去年同期单季净利润) / $|$去年同期单季净利润$|$*100


数据来自朝阳永续，\emph{预告净利润下限(万元)}可直接从数据库读取，如果不存在的话则使用第一行的公式。

\emph{上年同期净利润}，\emph{去年同期单季净利润}选择读取日期为去年同期报告期
]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont



\end{itemize}



\subsection{GARP策略}
\subsubsection{概述}
GARP（Growth at a Reasonable Price）策略是价值策略和成长策略的结合。价值策略是指寻找更好基本面且交易价格低于内在价值的股票的策略，成长策略则是寻找真实价值将上涨并超过当前价值的股票。GARP策略的思想是在高成长和低价格之间寻求平衡，目标是找寻具有持续增长潜力但价格合理或低估的股票。

\subsubsection{算法}
本策略的股票池为在全市场的股票中，当任意上市公司的年报业绩预告公布后，根据预先设置的下列指标对这些股票筛选，如果符合要求，则随后第一个交易日开盘买入并持有20个交易日。


相关指标和筛选标准如下：
\begin{itemize}
\item 增速指标
\begin{enumerate}
\item 基于最近一年数据计算的 归属于母公司净利润/股票总市值$>2\%$
\item 本年度一致预期净利润增长$>25\%$, 下一年度一致预期净利润增长$>25\%$以及未来两年一致预期净利润增长$>25\%$
\end{enumerate}
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[
一致预期净利润增长数据来自朝阳永续，选择读取日期为当日的前两个交易日]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont

\item 估值指标
\begin{enumerate}
\item $0<$本年度一致预期PE$<40$, $0<$下一年度一致预期$PE<30$
\item 本年度一致预期PEG$<1$
\end{enumerate}
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[
一致预期PE和PEG数据来自朝阳永续，选择读取日期为当日的前两个交易日]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont

\item 推荐强度
\begin{enumerate}
\item 潜在涨幅$>5\%$
\item 分析师一致评级$>0.8$
\end{enumerate}
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[
潜在涨幅 = 一致预期目标价/当日收盘价 - 1，
一致预期目标价和分析师一致评级数据来自朝阳永续，选择读取日期为当日的前两个交易日]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont

\end{itemize}



\newpage


\subsection{上证早知道信息交易策略}
\subsubsection{概述}
该策略是利用上证报推送的股票信息（上证盘中宝和上证早知道），经过简单筛选后持有1-2天时间，获得持续稳定收益的策略。

\subsubsection{上证早知道推送股票的统计分析}
本策略考虑的股票池为早知道中上证聚焦和上证精选板块中推荐的股票。测算的时间为2013年3 月27 日起至2014年11月13 日，共推荐1933支股票。用$T^{\OP}_{i}$，$T^{\CL}_{i}$表示消息公布后第$i$ 日（$i=0$指公布后第一天)股票开盘和收盘价。由于上证早知道信息于每日晚21 点30分公布，所以购买时间假设为随后交易日$T_{0}$ 的开盘时刻$T^{\OP}_{0}$，$T_{0}$日收益表达式为
\begin{eqnarray*}
\Rh_{0} = \frac{T^{\CL}_{0}-T^{\OP}_{0}}{T^{\OP}_{0}}
\end{eqnarray*}

随后几日($i\ge 1$)的收益计算为
\begin{eqnarray*}
\Rh_{i} = \frac{T^{\CL}_{i}-T^{\CL}_{i-1}}{T^{\CL}_{i-1}}
\end{eqnarray*}

根据以上公式以及数据统计得到的消息公布后连续几日的日收益率以及日平均收益分布如图\ref{ZaozhidaoReturn}。


\begin{figure}[H]
\centering
\begin{minipage}[c]{0.5\textwidth}
\centering\includegraphics[width=9cm,height=7cm]{ReturnDensity.jpg}% 就在前面括号中写图片名
\end{minipage}%
\begin{minipage}[c]{0.5\textwidth}
\centering\includegraphics[width=9cm,height=7cm]{ReturnDays.jpg}% 就在前面括号中写图片名
\end{minipage}
\renewcommand{\figurename}{图}
\caption{消息公布后-平均日收益变化以及日收益率概率密度图}
\label{ZaozhidaoReturn}

\end{figure}

由图\ref{ZaozhidaoReturn}可见，消息公布后首日收益的概率分布明显呈右偏形状，当日平均收益为0.54\%，随后几日平均收益逐步下降。虽然此处未考虑交易费用以及冲击成本，但是统计信息初步验证了根据早知道信息有设计出稳定收益策略的可能。

\subsubsection{上证盘中宝信息的统计分析}

本策略考虑的股票池为上证盘中宝产品推荐的股票信息，该信息是在当日收盘前不定时推送的。测算的时间为2013年1月4 日起至2014年10月31 日，共推荐2831支股票。

经过测算，如图\ref{ZaozhidaoReturn2}所示，盘中宝推送消息后短期内对股价有较明显的推动作用，在样本内计算的推送后10分钟内平均收益为0.89\%，但是随后当日股价会逐步回落。消息公布当天的最终日平均收益约为0.25\%.后续几天日平均收益在波动中缓慢下滑。

\begin{figure}[H]
\centering
\begin{minipage}[c]{0.5\textwidth}
\centering\includegraphics[width=9cm,height=7cm]{ReturnDensity2.jpg}% 就在前面括号中写图片名
\end{minipage}%
\begin{minipage}[c]{0.5\textwidth}
\centering\includegraphics[width=9cm,height=7cm]{ReturnDays2.jpg}% 就在前面括号中写图片名
\end{minipage}
\renewcommand{\figurename}{图}
\caption{消息公布后-平均收益变化以及收益率概率密度图}
\label{ZaozhidaoReturn2}

\end{figure}

%\begin{figure}
%\centering
%\scalebox{0.55}{\includegraphics{ReturnDensity.jpg}}
%\caption{消息公布后 - 日收益率概率密度图}
%\label{ReturnDensity}
%\end{figure}

由此可见利用盘中宝信息进行交易的策略核心是速度，在非程序化交易模式下这是一个有一定困难的交易策略。



\subsection{Smart Money情绪选股策略}

\fontsize{9}{11}
\selectfont

[跟踪聪明钱：从分钟行情数据到选股因子,\emph{魏建榕，高子剑}, 方正证券，2016]

\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}

\emph{“聪明钱”(Smart Money)}是指那些经验丰富、对市场理解成熟、或具备信息优势的专业投资者。追随“聪明钱”的投资方向经过验证\footnote{参考《跟踪聪明钱：从分钟行情数据到选股因子》,\emph{魏建榕，高子剑}, 方正证券，2016}能带来一定的收益。

\emph{Smart Money情绪选股}策略是一种$\a$策略。
在给定的范围的股票池中，策略买入特定时间段内\emph{情绪因子Q}值最小的N只股票，卖出该时间段内\emph{情绪因子Q}值最大的N只股票对冲以期获得超额收益。

\subsubsection{情绪因子Q}
\emph{情绪因子Q}设计用来衡量个股在特定时间段内Smart Money参与市场交易的相对价位。其计算步骤如下：

\begin{enumerate}
  \item 首先，剔除给定时间段内分钟数据成交量最小的五分之一样本\footnote{此操作对因子收益影响不大，仅出于逻辑严密的考虑。}后，计算衡量个股每分钟“聪明程度”的指标\emph{S}：
      \begin{equation}\label{Smart Money Index S}
        S_t=\frac{|R_t|}{\sqrt{V_t}}
      \end{equation}
  其中，$R_t$为第t分钟的涨跌幅，$V_t$为第t分钟的成交量。t时刻的$S_t$值越大，则表明该分钟的交易越“聪明”。

  \item 对于该股时间段内的分钟行情数据，将其按照指标\emph{S}从大到小进行排序。将成交量累计占比前20\%的交易视为“聪明钱”的交易。

  \item 在按照上述方法划分出“聪明钱”的交易之后，构建“聪明钱”的\emph{情绪因子Q}：
      \begin{equation}\label{Smart Money Index Q}
        Q=\frac{{\VWAP}_{smart}}{{\VWAP}_{all}}
      \end{equation}
  其中，${\VWAP}_{smart}$是聪明钱的成交量加权平均价，${\VWAP}_{all}$是特定时间段内所有交易的成交量加权平均价。

\end{enumerate}

因子\emph{Q}的值越大，表明Smart Money的交易越倾向于出现在价格较高处，可能是\emph{逢高出货}的行为，反映了悲观的态度；相反，因子\emph{Q}的值越小，表明Smart Money的交易多出现在价格较低处，可能是\emph{逢低吸筹}的行为，反映了专业投资者乐观的态度。


\subsubsection{策略算法}

本策略的具体算法如下：
\begin{enumerate}
  \item 本策略的股票池为全市场A股，剔除ST股、上市未满60日的新股和前期涨幅最大的五分之一的个股。
  \item 每个月月底，计算符合条件的股票近10个交易日的\emph{情绪因子Q}并从小到大进行排序，然后将其等分成5组。
  \item 次月第一个交易日买入第一组，即\emph{Q} 值最小的一组；卖出第五组对冲，即\emph{Q} 值最大的一组。
  \item 每个月月初调仓，调仓日涨停、停牌的股票不买入，跌停、停牌的股票不卖出。
\end{enumerate}



\newpage

\section{股指期货的套利与择时策略}
\subsection{期货保证金计算}

假设目前持有$N$手股指期货，当日股指期货价格为$F_{0}$，每个指数点对应的价格为$\alpha$, 期货保证金比率为$\lambda$;另外假设当前可用保证金数额为$M$，则当前保证金能够覆盖的股指期货上涨比例为$P$
\begin{eqnarray*}
P = \frac{M}{F_{0}N\alpha\left(1+\lambda\right)}
\end{eqnarray*}


\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[\begin{proof}
假设当股指期货上涨至$F^{*}$时，正好用尽保证金。

此时消耗的保证金有两部分，第一部分来自于上涨$\left(F^{*}-F_{0}\right)$点数对应的保证金亏损$\left(F^{*}-F_{0}\right)N\alpha$,另一部分来自于上涨$\left(F^{*}-F_{0}\right)$ 后期货要多占用一些保证金
$\left(F^{*}-F_{0}\right)N\alpha\lambda$。 由此可以得到
\begin{eqnarray}
M = \left(F^{*}-F_{0}\right)N\alpha + \left(F^{*}-F_{0}\right)N\alpha\lambda
\label{margincall}
\end{eqnarray}
根据公式(\ref{margincall} )可得$\frac{F^{*}-F_{0}}{F_{0}}=\frac{M}{F_{0}N\alpha\left(1+\lambda\right)}$

\end{proof}]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont

\subsection{ATM策略}
\subsubsection{概述}
ATM策略是部门自行开发的基于成交量和指数价格均线的\emph{日间}择时交易策略。成交量数据为同花顺软件实时公布的大单净差BBD数据，价格均线来自于上证A 股(000002.SH) 指数和50ETF(510050.SH)的交易数据。

\subsubsection{算法}

假设当前时刻为$t$。ATM策略信号的产生可以分成\emph{三个阶段}。

\emph{第一阶段}产生BBD信号，标记为$S_{t}^{B}$。
\begin{itemize}
\item 如果前日BBD小于设定下限，或者今日BBD 小于设定下限，或者今日BBD3日和4 日指数均线均小于设定下限，则信号为$S_{t}^{B}=0$
\item 如果前日BBD大于设定上限，或者今日BBD 大于设定上限，或者今日BBD3日和4 日指数均线均大于设定上限，则信号为$S_{t}^{B}=1$
\item 其他情况则$S_{t}^{B}=S_{t-1}^{B} $
\end{itemize}

\emph{第二阶段}产生基于市场价格的原始信号，记为$S^M_{t}$。该信号主要判断当前市场指数处于哪个阶段（上涨，波动和下跌）
\begin{itemize}
\item 如果当日50ETF与20日均线的偏差小于设定下限
\begin{enumerate}
\item 如果当日50ETF与20日均线的偏差创新高，并且当日50ETF的跌幅在$1.5\%$ 和$4.5\%$之内，则$S^M_{t}=0.9$
\item 如果连续五天50ETF收益为负，则$S^M_{t}=0.8$
\item 如果过去连续两日$S^M_{t}>0$,则$S^M_{t}=0$
\item 其他情况则$S_{t}^{M}=S_{t-1}^{M} $
\end{enumerate}

\item 如果当日50ETF与20日均线的偏差在设定的上下限之间
\begin{enumerate}
\item 如果当日50ETF的收益小于指数收益，并且50ETF收益为负,则$S^M_{t}=0.5$
\item 如果过去连续两日$S^M_{t}>0$,则$S^M_{t}=0$
\item 其他情况则$S_{t}^{M}=S_{t-1}^{M} $
\end{enumerate}

\item 如果当日50ETF与20日均线的偏差高于设定的上限
\begin{enumerate}
\item 如果当日50ETF收益为正并且前日上证指数收益没有超过设定上限，或者当日50ETF 收益为正并且前日50ETF收益为负，或者当日指数收益为正并且前日指数收益没有超过设定上限，或者当日50ETF收益比指数跌幅小，或者前日信号为正而且当日收益为正，则信号为$S_{t}^{M}=1$
\item 其他情况则$S_{t}^{M}=S_{t-1}^{M} $
\end{enumerate}

\end{itemize}

\emph{第三阶段}是对前两个阶段信号$S_{t}^{B}$ 和$S_{t}^{M}$的整理和修正，产生最终的信号$S_{t}^A$。\emph{依次}有以下几个主要步骤
\begin{itemize}
\item 如果当日50ETF高于20日均线阈值，但是小于短期均线（5日和10日），则$S_{t}^{A,1}=0$, 其他情况$S_{t}^{A,1}=S_{t}^{M}$
\item 如果$S_{t}^B = 1$，则$S_{t}^{A,2}=\lfloor \frac{\left(S_{t}^{B}+ S_{t}^{M} \right)}{2} \rfloor$,否则$S_{t}^{A,2}=S_{t}^{M}$
\item 如果$S_{t}^{A,1}=1$并且昨日指数涨幅在$0.3\%$和$0.76\%$之间，或者$S_{t}^{A,1}=1$ 并且昨日指数涨幅在$-0.8\%$和$0.1\%$之间，则$S_{t}^{A,3}=1$，否则$S_{t}^{A,3}=S_{t}^{A,2}$
\item 如果当日指数涨幅在$0.3\%$和$0.6\%$ 之间或者在$-0.8\%$和$0.1\%$之间,并且当日50ETF 与5日和20日均线的差距在阈值范围以内，则$S_{t}^{A,4}=1$,否则$S_{t}^{A,4}=S_{t}^{A,3}$
\end{itemize}

最终信号$S_{t}^A= S_{t}^{A,4}$。


\subsection{双轨(Dual Thrust)策略}


\fontsize{9}{11}
\selectfont

[Dual Thrust日内策略,\emph{魏刚}, 华泰证券，2012]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}
Dual Thurst策略和开盘区间突破策略类似，是以当日开盘价加减设定区间的一定比例确定上下轨，是较为常见的\emph{日内}交易策略，即当日内价格突破上轨时做多，突破下轨时做空。不同点主要体现在两方面


\begin{itemize}
\item Dual Thrust策略在设定区间的设置上，引入了前若干日的价位，使得该区间相对稳定，可以适用于日间的趋势跟踪
\item Dual Thrust对于多头和空头的触发条件，考虑了非对称的幅度，做多和做空的区间可以选择不同的周期数或者上下轨的系数
\end{itemize}

\subsubsection{算法}
用$P_{HH,N},P_{HC,N},P_{LC,N},P_{LL,N}$表示前$N$(不包括当日)的最高价的最高价，收盘价的最高价，收盘价的最低价和最低价的最低价，用$k_{s},k_{x}$表示上下轨系数，用$N_{s},N_{x}$ 表示上下轨计算宽度时的周期数, 用$\Ph_{o}$表示当日开盘价。

令$R_{N} = \max \left( P_{HH,N}-P_{LC,N},P_{HC,N}-P_{LL,N} \right)$, 则上轨宽度为$W_{s} = \Ph_{o} + k_{s}R_{N_{s}}$,下轨宽度为$W_{x} = \Ph_{o} - k_{x}R_{N_{x}}$

当日内价格当日内价格突破上轨时做多，突破下轨时做空。



\subsubsection{策略回测}
参数设置为$k_{s} = 0.2, k_{x} =0.4, N_{s} = 3, N_{x} = 2$。标的为中证500指数，数据频率为5 分钟，回测的累计收益率曲线图如下。




\begin{figure}[H]
  \begin{center}
    \leavevmode
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{zz500_noShort}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{zz500_noShort}
    \fi
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{zz500_Short}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{zz500_Short}
    \fi
    \caption{测试时间为2015年1月25日至2015 年10 月25日，左图为不可卖空情况下累计收益，右图为可卖空情况下累计收益}
    \label{FigDT2015}
  \end{center}
\end{figure}


\begin{figure}[H]
  \begin{center}
    \leavevmode
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{zz500_2014_noShort}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{zz500_2014_noShort}
    \fi
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{zz500_2014_Short}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{zz500_2014_Short}
    \fi
    \caption{测试时间为2014年1月25日至2014 年12 月25日，左图为不可卖空情况下累计收益，右图为可卖空情况下累计收益}
    \label{FigDT2014}
  \end{center}
\end{figure}




\subsection{Hurst指数策略}
%\emph{参考文献: 股市动力学分析:Husrt分形结构变化,程志田, 国海证券，2010}
%\vspace{0.3cm}

\fontsize{9}{11}
\selectfont

[股市动力学分析:Husrt分形结构变化,\emph{程志田}, 国海证券，2010]

[Hurst指数在A股市场中的应用,\emph{曹源}, 国都证券，2010]

[Hurst再战江湖：Hurst，Hurst MA与Hurst Cluster,\emph{刘湘宁},华泰证券，2010]

[局部Hurst指数在中国股市中的应用,\emph{邱小平}， 浙商证券, 2011]

\fontsize{10}{11}
\selectfont
\vspace{0.5cm}
\subsubsection{概述}
Hurst指数是一个在混沌和分形学科中判断时间序列混沌性和成群性的统计参数。时间序列的Hurst指数可以定量表征时间序列的持续性或长期相关性。若一个市场具有长记忆性，
说明该市场中商品过去的价格对其未来的价格影响有较长的持续性，这意味着商品未来的价格不仅受到当前价格的影响还受到过去价格的影响，通过Hurst指数的值来反映时间序列的依赖性，
可以有效地测定时间序列数据中存在的趋势性。
\subsubsection{算法}

\paragraph{R/S分析法}
Husrt指数的算法有好多种，此处介绍R/S分析法。

对于时间序列$\{x_{t}\}$,$t=1,2...N$,将此序列分为长度为$n$的$A$个等长区间，对于每个子区间，如第$a$ 个子区间（$a=1,2,...,A$), 令
\begin{equation*}
  X_{t,a}=\sum_{i=1}^t (x_{i,a}-M_a), t=1,2,...,n
\end{equation*}
其中，$M_a$为第a个区间内$x_{i,a}$的平均值,即$M_a = \frac{1}{n}\sum_{i=1}^n x_{i,a}$。$X_{t,a}$为第$a$个区间内第$t$个元素的累计离差。

定义区间$a$上的极差$R_a$为
\begin{equation*}
  R_a=\max(X_{t,a})-\min(X_{t,a})
\end{equation*}

若以$S_a$表示第$a$个子区间的样本标准差，即$S_a = \sqrt{\frac{1}{n}\sum_{i=1}^n \left( x_{i,a} - M_{a} \right)^2}$,则可定义重标极差$\left( \frac{R_a}{S_a} \right)$。 把所有$A$ 个这样的重标极差平均起来求得均值$\left( \frac{R}{S}\right)_n$
\begin{equation*}
  \left( \frac{R}{S}\right)_n=\frac{1}{A}\sum_{a=1}^A \frac{R_a}{S_a}
\end{equation*}

由于子区间的长度$n$可变，最初由水文学家Hurst 提出$\left( \frac{R}{S}\right)_n$满足以下关系
\begin{equation}
  \log \left( \frac{R}{S}\right)_n=\log(K)+H\log(n)
\label{Hurst}
\end{equation}
根据公式(\ref{Hurst})通过回归拟合得到的斜率$H$就是Hurst指数。本节的Hurst指数分析方法称为$R/S$分析法。

\paragraph{股票市场的数据处理}
在对股票价格等经济时间序列应用$R/S$分析法时，需要对数据进行一些处理。

首先要构造对数收益的时间序列
\begin{equation*}
 r_t = \log \left(\frac{S_t}{S_{t-1}}\right)
\end{equation*}

然后以$r_t$作为因变量，$r_{t-1}$作为自变量，进行回归分析，并得到$R_t$的AR(1) 残差序列
\begin{equation}
  x_t=r_t-(a+b*r_{t-1})
  \label{Hurst_x}
\end{equation}
公式(\ref{Hurst_x})中的$x_t$就是进行R/S分析的对象。对数收益序列的构造和AR(1) 残差法的使用是为了最大限度的消除经济时间序列中的线性依赖，因为线性依赖本身可能导致Hurst 指数的偏离。


\paragraph{平均循环周期}

时间序列的长期记忆性可以通过统计量$V_{n} =  \frac{\left(R/S\right)_{n}}{\sqrt{n}} $来测算。如果$\left( R/S\right)_{n}  \sim \sqrt{n}  $,那么$V_{n}$在以$\log(n)$ 为横坐标的坐标系中是一条水平线\footnote{令公式(\ref{Hurst})中$H=0.5$,可得到$\frac{\left(R/S\right)_{n}}{\sqrt{n}} =K$， 即$V_{n}$为常数}。当一个时间序列有记忆性($H>0.5$) 时，$\left( R/S\right)_{n}$值的增长速度要高于$\log(n)$，则相应的直线应该是向上的；反之，当$H < 0.5$时，相应的直线应该是趋势向下的。那么在以$V_{n}$为纵坐标，$\log(n)$ 为横坐标的坐标系中，循环周期的长度对应于$V$ 图形走势改变的时点，也就是市场记忆性开始消失的时点。

另外，也可以直接观察$\log \left( R/S\right)_{n}$ 对于$\log(n)$，当曲线出现转折，不再是线性关系时，对应的时间就是最大循环周期。




\paragraph{局部Hurst指数}
在时间段$[t,t+n-1]$内，选取时间段 $[t,t+k-1]$,$k \le n$,使用R/S方法计算出这个区间的Hurst 指数$H_{k}$， 时间段 $[t,t+k-1]$称为$[t,t+n-1]$上的时间窗口，$H_{k}$ 是$[t,t+n-1]$ 上的局部Hurst指数。 对于$[t+j,t+k-1+j]$,$j=0,1,2,...n-k$, 可以得到一组局部Hurst指数$H_{ij}$。

时间窗应该尽量包含一个平均循环周期，因此$n$大于循环周期，而$N$应不小于$2n$。


\paragraph{Hurst阈值簇}
\emph{Hurst阈值簇} 是指单日Hurst指数在一定时间段内频繁突破阈值的现象，该指标的引入是为了规避单日Hurst指数的不稳定性。

当单日Hurst值在阀值上方游走一定时间后，首次向下击穿阀值时，我们把它作为一个新的阀值簇的开始时间；当单日Hurst 指数离开阀值并稳定于阀值上方游走，在一定时间内不再触碰阀值时，作为本轮阀值簇的结束。Hurst 簇作为经验值，既考虑到重要的Hurst首次单日突破阀值的情形与最后一次接触阀值的情形又回避了单日Hurst的及其不稳定性，能够形成较为领先且相对稳定的指标。

\paragraph{Hurst期望值}Hurst指数期望值的算法与Hurst 指数的算法类似，即对$\log\{E[(R/S)_n] \} $ 和$\log(n)$ 进行最小二乘回归求得。对于$E[(R/S)_n]$的计算我们采用Peters 提出的如下公式：
\begin{equation*}
 E[(R/S)_n] = [(n-0.5)/n]*(n*\pi/2)^{-0.5}*\sum_{r=1}^{n-1}\sqrt{(n-r)/r}
\end{equation*}
其中n为子序列中每一个分段的长度。

Hurst期望值只依赖于子窗口的长度$n$。


\subsubsection{结果分析}
\paragraph{理论分析}Hurst指数落在不同区间的含义是
\begin{enumerate}
  \item $H \in (0,0.5)$: 表示时间序列具有反持续性，未来可能出现的趋势将与过去相反，过去越是下跌，则未来上涨的可能性很大，反之亦然。
  \item $H = 0.5$: 意味着对于任何时刻t, 过去增量与未来增量没有任何相关性，稳定帕累托分布退变为正态分布，股价为随机游动过程。
  \item $H \in[0.5,1)$: 意味着稳定的分形市场，具有持续性，且强度取决于H指数接近1的程度。如果上一个时间期间是涨升（下降）的，那么下一个时间期间将继续涨升（下降）。
\end{enumerate}


理论上来讲，Hurst指数在刻画市场反转时既能反映上升趋势的终结，也能反映止跌回升的开始，但是很多研究也都指出在进行资本市场实证时，反映止跌回升的开始并不像反映上升趋势的终结那么有效，所以大部分实证性的文章都是关于用Hurst指数刻画市场下跌时期特征的。我们还可以发现，市场上涨时，如果Hurst指数能够迅速上升，则接下来市场会呈现持续上涨的态势。这种现象与理论结果要求也是一致的，Hurst指数的上升，表明未来市场走势与前期市场表现正相关性增强，那么在前期市场上涨的条件下，Hurst 指数上升表明市场延续前期上涨的可能性越大。




\subsubsection{交易策略}



\subsection{LPPL市场泡沫模型}

\fontsize{9}{11}
\selectfont

[股市泡沫反泡沫研究， 国泰君安证券， \emph{刘富兵，蒋瑛琨}， 2012]

[Everything You Always Wanted to Know about LPPL, \emph{Petr Geraskin}, 2010]

[A Stable and Robust Calibration Scheme of LPPL Model, \emph{Vladimir Filimonov, Didier Sornette}, 2011]

[Real-time prediction and post-mortem analysis of the Shanghai 2015 stock market bubble and crash, \emph{Didier Sornette, Guilherme Demos}, 2015.08]

[Diagnosing Bubbles in Fixed Income Markets, \emph{Tuncay Michael Irmak, Burgdorf}, 2015.10]

\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}
LPPL全称为对数周期幂律(Log - Periodic Power Law)，此模型源自于地球物理中地震与材料断裂等临界现象的理论模型，后被物理学家Sornette应用于预测金融市场的泡沫形成与破裂，即研究金融市场的拐点。

LPPL模型描述的现象是基于交易者之间的相互模仿，这些局部相互作用可形成正反馈，从而导致泡沫和反泡沫的产生，因此该模型可用于金融泡沫和反泡沫的建模和预测。金融市场反泡沫表现在价格演化中，即价格演化呈现出对数周期性振荡且振荡周期不断延长。金融泡沫表现为振荡周期不断缩短。

\subsubsection{模型拟合}

对于在$[t_{1},t_{2}]$区间内的时间序列$p_{t}$， LPPL模型认为其服从

\begin{equation}
\ln p_{t}= A + B\left(t_{c} - t \right)^m + C\left(t_{c} - t \right)^m \cos\left[ \om \ln\left(t_{c} - t \right) + \phi \right]
\label{LPPLMain}
\end{equation}

$t_{c}$是临界时间（泡沫破裂时间）；$A$ 是指若泡沫持续到临界时间$t_{c}$时，$p_{t}$能达到的价格；$B<0$是指在临界时间前价格是向上的加速过程，$B>0$ 是指在临界时间前价格是向下的加速过程；$C$ 是围绕指数增长的一个波动幅度量值，量化对数周期震动;$m$ 是幂指数，衡量价格上涨的加速程度；$\om$是泡沫期波动的角频率； $\phi$是周期波动的初相位。

公式(\ref{LPPLMain})第二项$B\left(t_{c} - t \right)^m $幂律项描述了价格的加速来自正向反馈机制, 第三项$C\left(t_{c} - t \right)^m \cos\left[ \om \ln\left(t_{c} - t \right) + \phi \right]$可以看做是对超指数行为的修正

LPPL模型存在两个显著特征
\begin{itemize}
\item 对数周期震荡，在线性尺度下，越接近临界时间，振荡频率越快。但是在对数尺度下，振荡频率为常数
\item 幂律增长，即超指数增长，即价格的增长率不是常数，而是单调递增
\end{itemize}

关于模型参数的有效约束条件在章节(\ref{LPPL_Conf})中有进一步的讨论。

%\paragraph{约束条件}
%模型的一般约束条件可以总结为$0 \le m \le 1, 6 \le \omega \le 13, |C|<1, B<0,t_{c}>t_{2}$
%\begin{itemize}
%\item $0 \le m \le 1$来自于模型推导中危机概率小于等于1的要求，以及拟合经验
%\item $6 \le \omega \le 13$为确保对数周期的波幅不至于过大或者过小
%\item $|C|<1, B<0$是要保证模型推导中的hazard rate大于零
%\end{itemize}
%在章节(\ref{LPPL_Conf})中对此有进一步的讨论。



\paragraph{模型的拟合}
经过降维变换，优化问题的参数最终从七个变成了三个，即$\left( t_{c},m,\om \right)$，大大减小了拟合的复杂度。降维和拟合的具体方法见章节(\ref{App_LPPL_Calib})。

拟合过程中有两个值得注意的问题
\begin{itemize}
\item 时间序列$t$使用的是整数序列,即$t=1,2,3...$，表示第几个交易日（如果使用日频数据）或者表示第几个分钟（如果使用分钟数据）
\item 拟合起始时间点的选取对最终结果$t_{c}$ 影响较大，建议选取明显的低点或者高点，作为泡沫或者反泡沫估算的最佳起始点
\end{itemize}

%\paragraph{残差分析}
%针对拟合的残差项可以使用Lomb非等间距频谱分析方法进行验算，以检验其对数周期震荡的性质。Lomb 算法是针对非等间距数
%据设计的，类似于傅立叶谱分析方法，可以检测出每个频率$\om$上的振幅$P_{N}(\om)$。如果存在一个频率$\om_{l}$, 其对应的振幅很大并且能够通过显著性水平检验，那么久说明该数据存在对数周期性质。

%定义残差项为
%\begin{equation*}
%r(t) = \left( \widehat{t}_{c}-t \right)^{-m} \left( \ln p(t)-\Ah-\Bh(t_{c}-t)^m \right)
%\label{LPPLRes}
%\end{equation*}

%从公式(\ref{LPPLMain})可以看出对数周期的震动来自于$\cos$项。显著的频率$\om_{l}$可以拟合出的$\widehat{\om}$ 比较，二者的数值应该接近。

%\paragraph{Crach Lock-in Plot图}
%Crash Lock-in Plot(CLIP) 是指针对不同拟合时间窗口计算出的反转时间的图 - 横轴对应的是拟合时间的结束时点，纵轴对应的是估计的反转时间$\widehat{t}_{c}$。如果一个反转的趋势已经临近，那么估计的参数$\widehat{t}_{c}$应该稳定在一个常数附近。

\subsubsection{LPPL Confidence 和Trust 指数}
\label{LPPL_Conf}
\emph{LPPL Confidence}和\emph{LPPL Trust}是\emph{Sornette}于2015年提出的判断泡沫破裂点的新方法。


\paragraph{计算方法}
\emph{LPPL Confidence}是指不同数据长度的窗口下有多少比例是有效的拟合。步骤为：

\begin{enumerate}
  \item 对于每一个时间点(拟合终点)$t_2$，选取不同长度的时间序列进行模型拟合。不断往前延伸拟合起点$t_1(t_1<t_2)$， 得到若干个时间区间。

\fontsize{9}{11}
\selectfont
[具体操作上，选取三类时间窗口集合，即小区间(长度从50-100)，中等区间(长度从150-250)和长区间(长度从250-500)三类，时间间隔为5个交易日，对应子区间数目分别为20，30和50]
\fontsize{10}{11}
\selectfont

  \item 对于每一组时间序列进行LPPL模型拟合，拟合出的结果根据\emph{Sornette}提出的表\ref{LPPL Filtering Table}中过滤条件Filtering Condition 1进行过滤。

\fontsize{9}{11}
\selectfont
[

表\ref{LPPL Filtering Table}中约束条件的解读
\begin{itemize}
\item 对$m$的约束源自于模型推导中hazard rate 小于等于1的要求，以及拟合经验。也有算法设置成$0 \le m \le 1$
\item $\om$的约束条件是确保对数周期的波幅不至于过大或者过小
\item $t_{c}$的约束条件是指转折点在拟合终点附近，如果$t_{c}$离拟合终点太远则警示意义很小，可以忽略
\item Damping比率的约束源自对于hazard rate非负的要求
\item 相对误差项则要求每一点的拟合误差不差过一定程度，比如$5\%$
\end{itemize}

]
\fontsize{10}{11}
\selectfont


  \item 统计样本中满足过滤条件的时间窗口占所有时间窗口的比例，即为时间点$t_2$的LPPL Confidence指数。
\end{enumerate}


\emph{LPPL Trust}是为了衡量残差项对于拟合结果的影响。步骤为：

\begin{enumerate}
    \item 每一个不同长度的时间窗口$[t_1, t_2]$ 先进行一次拟合，获取该时间窗口下对应的残差序列。然后将残差序列$\e_{t}$ 重新随机排列并与模型拟合后估计的对应价格序列$\ph_{t}$相加合成一组新的时间序列$p^*_{t}$。

\fontsize{9}{11}
\selectfont
[

定义$f(t)$为$t$到$t$的随机映射函数，
一次resampling可以定义为
$p^*_{t_{i}}= \ph_{t_{i}}+\e_{f(t_{i})}=\ph_{t_{i}}+\e_{t_{j}}$

]
\fontsize{10}{11}
\selectfont

    \item 对新合成的时间序列$p^*_{t}$重新使用LPPL模型拟合，拟合出的结果根据表\ref{LPPL Filtering Table}中的过滤条件Filtering Condition 2进行判断是否为有效拟合。
    \item 对同一个时间窗口重复reampling100次，统计新的时间序列中有效拟合比例。
    \item 统计出时间点$t_2$对应的所有时间窗口计算结果的中位数，即为该时间点的LPPL Trust指数。
\end{enumerate}


\begin{table}
    \begin{tabular}{|c|c|c|c|c|}
      \hline
      % after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
      Item & Notation & Search Space & Filtering Condition 1 & Filtering Condition 2 \\
      \hline
      3 Nonlinear Parameters & $m$ & [0, 2] & [0.01, 1.2] & [0.01, 0.99] \\
        & $\omega$ & [1, 50] & [2, 25] & [2, 25] \\
        & $t_c$ & $[t_2,$ & $[t_2,$ & $[t_2,$ \\
        &   & $t_2+0.2dt]$ & $t_2+0.1dt]$ & $t_2+0.1dt]$ \\
      %Number of Oscillations & $\frac{\omega}{2}ln|\frac{t_c-t_1}{t_2-t_1}|$ & - & $[2.5, +\infty)$ & $[2.5, +\infty)$ \\
      Damping & $\frac{m|B|}{\omega|C|}$ & - & $[0.8, +\infty)$ & $[1, +\infty)$ \\
      Relative Error & $\frac{p_t-\widehat{p_t}}{\widehat{p_t}}$ & - & [0, 0.05] & [0, 0.2] \\
      \hline
    \end{tabular}
    \caption{LPPL Filtering Table}\label{LPPL Filtering Table}
\end{table}
%\subsubsection{LPPL Trust 指数}
%\paragraph{LPPL Trust}由于LPPL模型的拟合过程是试图从时间序列中分离未知的残差，生成LPPL信号，所以不同情况下的残差敏感性测试就变得很重要。LPPL Trust指数就是设计用来衡量实际的价格序列与理论模型的相似程度的指标。指数值为0时代表时间序列完全不符合模型，而指数值为1代表输入的时间序列完全符合LPPL理论模型。根据历史经验，当LPPL Trust值大于5\%时，通常意味着目前的价格趋势不稳定并且存在走势反转的可能性。

%\paragraph{LPPL Trust计算}是通过测试在不同残差情况下时间序列与模型的重合度来判断泡沫生成信号的可信度。
%\begin{itemize}
  %\item 对于每一个时间点$t_2$的特定时间窗口$(t_1,t_2)$，进行LPPL模型拟合，获取最优参数后计算该时间序列的残差。
  %\item 对模型重取样，将模型对应产生的残差随机打乱并合并至LPPL模型生成的时间序列中，生成一组新的合成时间序列。对新的时间序列重新进行LPPL拟合，对于拟合的结果使用上表中Filtering Condition 2来判断拟合结果是否符合LPPL模型。
  %\item 将重取样的步骤重复执行100次，计算符合模型的拟合结果占全部重取样测试的比例。
 % \item 统计时间点$t_2$总计126组不同时间长度（$125\leq dt \leq 750$)对应的符合模型的比例，通过计算所有时间窗口结果的中位数，即可获取该时间点$t_2$的LPPL Trust 指数。
%\end{itemize}


\subsection{抛物线逼近策略}

\fontsize{9}{11}
\selectfont

[探寻抛物线逼近下的创业板拐点， 广发证券， \emph{安宁宁}， 2014]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}
此处介绍的抛物线逼近模型，基本方法是通过二次函数对时间序列的局
部序列进行拟合，并据此寻找时间序列处于衰弱期和转向期之间的拐点。

\subsubsection{策略算法}
对一段时间内的价格(如收盘价)序列$\{ p_{1},p_{2}...p_{n}  \}$进行二项式拟合，拟合函数为
\begin{eqnarray}
y = ax^2+bx+c
\label{Poly_Main}
\end{eqnarray}
其中$y$为价格序列$\{ p_{1},p_{2}...p_{n}  \}$，$x$为下标$\{1,2,3...n\}$

价格序列中每多一个价格数据，就可以根据公式(\ref{Poly_Main})拟合出一条二次函数曲线。当市场出现拐点时，上一交易日计算出的二次曲线和当日计算出的二次曲线的将指向相反的方向，当日计算出的曲线将出现切线为0 的部分。本节称此时刻为拐点。

在拐点出现的第$N$天后，如果拟合二次曲线的二阶导数和拐点出现时候的二阶导数同正负，则拐点得到了确认，给出择时信号。如果拐点没有得到确认，则继续找寻新的拐点出现的位置。

一旦拐点确认，则以拐点出现的位置为新的起始点。随着时间的推移直至找到新的拐点。

\subsection{TD指标策略}

\fontsize{9}{11}
\selectfont

[基于修正TD 指标的指数择时研究， 广发证券， \emph{罗军}， 2010]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}
TD指标是大型投资基金Tudor 的执行副总裁(Thomas DeMark) 于20世纪80 年代中期为了发现走势转折区域而设计的。TD 指标通常可分为TD 序列和TD 组合。TD 序列由启动、交叉和计数三个阶段组成，而TD 组合则仅包
括启动和计数两个阶段，两者的主要区别在于计数规则的不同，但其基本原理都是一致的，即：市场走势
由买方和卖方共同作用形成，当买方的力量大于卖方时走势表现为上涨，反之为下跌，但买卖双方力量强
弱的表象是动态的，当走势上涨一段时间后，买方力量必然面临衰竭，从而市场转为下跌，TD 指标正是
为发现走势欲转折区域而设计的。

\subsubsection{策略算法}
此处介绍经过广发研究报告修正过的TD组合指标策略。

设$p^c_{i},p^h_{i},p^l_{i}$为第$i$日的收盘价，最高价和最低价格。用$n_{1}$表示买入启动或者卖出启动形态形成时候的价格比较滞后期数，
$n_{2}$表示买入启动或者卖出启动形态形成时候的价格关系单向连续个数，$n_{3}$表示模型计数阶段的最终信号发出所需计数值。


\begin{eqnarray*}
\UD_{i} = \begin{cases}
1 &{p^c_{i}>p^c_{i-n_{1}}}\\
-1&{p^c_{i}<p^c_{i-n_{1}}}\\
0&{else}
\end{cases}
\end{eqnarray*}

策略的计算步骤为
\begin{enumerate}
\item 计算$\UD_{i}$, 并对$\UD_{i}$进行累加计算，且当$\UD_{i} \not= \UD_{i-1} $, 停止本次累加
\item 当$\UD_{i}$的累加计算结果为$n_{2}$时为一个卖出启动的形成，当计算结果为$-n_{2}$时为一个买入启动的形成
\item 于买入启动后形成的第一个K线开始买入计数，在某一个K线上同时满足以下三个条件，买入计数累加1，当计数累加至$n_{3}$发出买入信号
\begin{itemize}
\item 收盘价大于或等于之前第2 根K 线最高价
\item 最高价大于之前第1根K 线的最高价
\item 收盘价大于之前第1个计数处的收盘价
\end{itemize}

\item 于卖出启动形成的随后第一个K线位置开始卖出计数，在某一个K线上同时满足以下三个条件，卖出计数累加1，当计数累加至$n_{3}$发出卖出信号
\begin{itemize}
\item 收盘价小于或等于之前第2 根K 线最低价
\item 最低价小于之前第1根K 线的最低价
\item 收盘价小于之前第1个计数处的收盘价
\end{itemize}

\item 当形成一组新的买入启动时，取消上一组未最终形成买入信号的买入计数

\item 当形成一组新的卖出启动时，取消上一组未最终形成卖出信号的卖出计数

\end{enumerate}

该策略\emph{止损方法}为:若当前是买入信号，买入计数过程中的市场最低点为止损点；若当前是卖出信号，卖出计数形成过程中的市场最高点为止损点。在市场未触及止损点之前，一直持有头寸，直到出现反向信号或者被迫止损为止。

图(\ref{Fig2016-05-11TD})标注了一段走势中买入卖出启动和计数的过程，以演示5月9号的空头平仓信号的由来。对应的参数为
\begin{itemize}
\item 买入启动或者卖出启动形态形成时候的价格比较滞后期数 $n_{1}=5$
\item 买入启动启动形态形成时候的价格关系单向连续个数$n^l_{2}=2$
\item 买入计数阶段的最终信号发出所需计数值$n^l_{3}=5$
\item 卖出启动启动形态形成时候的价格关系单向连续个数$n^s_{2}=3$
\item 卖出计数阶段的最终信号发出所需计数值$n^s_{3}=8$

\end{itemize}


\begin{figure}[H]
  \begin{center}
    \leavevmode
    \ifpdf
      \includegraphics[height=3in,width=6in]{Fig2016-05-11TD}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{Fig2016-05-11TD}
    \fi
    \caption{TD策略信号生成演示图：使用数据为2016年5月9日中证500指数的5分钟K线图}
    \label{Fig2016-05-11TD}
  \end{center}
\end{figure}
\subsubsection{低延迟线策略}

\fontsize{9}{11}
\selectfont

[低延迟趋势线与交易性择时， 广发证券， \emph{安宁宁}， 2013]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}
\subsubsection{概述}
趋势跟踪指标，比如移动平均线指标，普遍具有时滞性与平滑性的矛盾，即计算天数越多，平滑性越好，但是时滞性越严重。低延迟趋势线则是为了解决这一矛盾，利用信号处理的原理，保存了低频率信号的输出，同时相对于普通均线指标，其延迟大幅下降。

\subsubsection{策略算法}
\paragraph{信号的传输函数}
用$P_{t}$,$f_{t}$表示$t$时刻标的价格以及趋势指标。对于复数$z$和离散序列$\{ f_{t}\}$，定义z变换为$F(z) = \sum\limits_{t=-\infty}^{\infty}f_{t}z^{-t}$。

此处定义传输函数为输出信号(趋势指标序列)的z变换与输入信号(标的价格序列)的z变换的比值。

比如对于$\EMA$指标，$t$时刻的$\EMA_{t} = \a P_{t} + (1-\a) \EMA_{t-1}$,$0<\a<1$，其传输函数为
\begin{eqnarray}
H(z) = \frac{\EMA(z)}{P(z)}
\label{EMA_H_def}
\end{eqnarray}





根据z变化的线性性质以及时位移性质，可知$\EMA(z) = \a P(z) + (1-\a) \EMA(z) z^{-1}$,代入公式(\ref{EMA_H_def}) 并整理可得到$\EMA$指标传输函数的表达式
\begin{eqnarray}
H(z) = \frac{\a}{1-(1-\a)z^{-1}}
\label{EMA_H}
\end{eqnarray}

\vspace{0.5cm}
\fontsize{9}{11}
\selectfont

[\begin{proof}
\begin{eqnarray*}
H(z) &=& \frac{\a P(z) + \left( 1-\a \right)\EMA_{t-1}(z)}{P(z)} \\
&=& \a + \left(1-\a \right)  \frac{\EMA_{t-1}(z)}{P(z)}\\
&=& \a + \left(1-\a \right) z^{-1} \frac{\EMA_{t}(z)}{P(z)}\\
&=& \a + \left(1-\a \right) z^{-1}H(z)
\end{eqnarray*}
所以可得$H(z) =\frac{\a}{1-(1-\a)z^{-1}} $

\end{proof}]
\vspace{0.5cm}
\fontsize{10}{11}
\selectfont



假设$z = e^{i\om}$。从公式(\ref{EMA_H})可以看出，当价格序列为常数时，频谱对应零频率，$\EMA$ 指标收敛
于该常数, 此时$z^{-1}=1(\om =0 )$,传输函数等于 1，输出信号与输入信号完全相同，不产生
增益或衰减；反之，当频率等于信号可能的最高频率时，$z^{-1}=-1(\om =\pi )$, 传输函数等于$\frac{\a}{2-\a}<1$, 高频成
分被最大限度地衰减。也就是说，传输函数在产生 $\EMA$ 信号过程中，对高频成分具
有衰减作用，如果将上述 $\EMA$ 指标作为滤波工具，相当于一个一阶低通滤波器。

\paragraph{LLT指标}
从$\EMA$ 指标传输函数可以看到，即便在$z^{-1}=-1$ 时，传输函数为$\frac{\a}{2-\a}<1$，也
就是说仍然有高频分量输出。需要有更好的指标能够彻底过滤掉高频分量。

通过调整传输函数的表达式(最高频分量被完全过滤，提高阶数使得在截止频率附近衰减的更快)\footnote{具体方法参见本章参考文献}，可以得到二阶低通滤波传输函数

\begin{eqnarray}
\frac{\LLT(z)}{P(z)} = \frac{\left(\a - \a^2/4 \right) + \left(\a^2/2 \right)z^{-1} - \left(\a - 3\a^2/4 \right) z^{-2}}{1-2\left(1-\a \right)z^{-1} + \left(1-\a \right)^2 z^{-2}}
\label{LLT_H}
\end{eqnarray}

根据公式(\ref{LLT_H})可得到
\begin{eqnarray}
\LLT_{t} = \left(\a - \a^2/4 \right)P_{t} + \left(\a^2/2 \right)P_{t-1}- \left(\a - 3\a^2/4 \right)P_{t-2} + 2\left(1-\a \right)\LLT_{t-1} - \left(1-\a \right)^2\LLT_{t-2}
\label{LLT_def}
\end{eqnarray}

相比于普通的趋势线指标，低延迟线(LLT)具有更显著的拐点和更低的延迟。

\paragraph{交易策略}
根据历史数据拟合出LLT曲线，计算出每一时刻$t$对应的LLT曲线上的点的斜率$\b_{t}$。 计算斜率的方法为包含$t$时刻在内的LLT曲线上的最近3个点进行二次曲线拟合，求出$t$ 时刻对应的点的斜率。

用$\b^l_{t},\b^s_{t}$表示多头和空头开仓的斜率阈值。

如果$\b_{t}> \b^l_{t}$则多开，如果$\b_{t} < 0.5\b^l_{t}$则多平。

如果$\b_{t}<- \b^s_{t}$则空开，如果$\b_{t} > -0.5\b^s_{t}$则空平。

\subsection{波动率差值策略}
\fontsize{9}{11}
\selectfont

[基于相对强弱下单向波动差值应用， 国信证券， \emph{黄志文}， 2015]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsubsection{概述}
指数的波动率通常被用来观察市场情绪或者预测市场趋势。由于A股市场做空机制欠缺，波动率分布并不对称，故可以把波动率区分为上行波动率和下行波动率:以开盘价为基准开盘价以上的波动为上行波动率，反之为下行波动率，二者之差称为波动率差值；同时引入市场相对强弱RPS指标来判断市场强势与否。结合二者构成了RPS指标下的波动率差值策略。


\subsubsection{算法}
用$P^o_{t}$,$P^h_{t}$,$P^l_{t}$,$P^c_{t}$表示$t$时刻标的k线的开盘，最高，最低和收盘价，$R_{t}$表示t时刻的涨幅。用$\s^u_{t}$,$\s^d_{t}$表示$t$时刻的上行和下行波动率， 其中$\s^u_{t} = \frac{P^h_{t}-P^o_{t}}{P^h_{t}}$, $\s^d_{t} = \frac{P^o_{t}-P^l_{t}}{P^h_{t}}$

\begin{itemize}
\item 计算相对强弱指标$\RPS_{t}(k)=\frac{P^c_{t}- \min\left( P^c_{t},....P^c_{t-k} \right)}{\max\left( P^c_{t},....P^c_{t-k} \right) - \min\left( P^c_{t},....P^c_{t-k} \right)}$, 取$N^a$个时刻的移动平均作为最终指标
\item 计算上下行波动率$\s^u_{t}$,$\s^d_{t}$， 并计算二者差值$\d_{t} = \s^u_{t}-\s^d_{t}$
\item 计算当天波动率差值的移动平均值(步长$N^{a}$由RPS值决定，RPS越大步长越大, 比如$\RPS = 85\%$,就取$N^b=85$), $\MA(d_{t}(N), N^{a})$
\item 如果前一天波动率差值的移动平均值为正，则买入，否则空仓（或者卖出）

\end{itemize}

该策略使用日频的指数数据进行回测，对于RPS指标取$k=250$, $N^a = 10$



\subsection{回归线趋势策略}
\subsubsection{概述}
回归线策略是一种类似于均线策略的趋势性策略，判断趋势的方法主要依据对历史数据进行一元线性回归拟合，根据拟合出的斜率以及预测值与真实值的差进行趋势判断。


\subsubsection{算法}

用$P_{t}$表示在$t$时刻的价格，该时刻价格趋势的回归方程为
\begin{eqnarray}
{P_{t-N+i}} = \a_{t} i + \b_{t}
\label{Reg_Main}
\end{eqnarray}
公式(\ref{Reg_Main})中$i = 1,2,3...N$, $N$为回归拟合的长度。

令$\D_{t} = P_{t} - \a_{t}N - \b_{t} $, $\D_{t-1} = P_{t-1} - \a_{t}\left(N-1\right) - \b_{t} $。 同时定义规范化斜率$\a_{t}^* = \frac{\a_{t}}{\b_{t}}*252$，用$\th^l_{t} = \frac{\max\{ P_{i}: i = 0..t\} - P{t}}{\max\{ P_{i}: i = 0..t\}}$ , $\th^s_{t} = \frac{P{t}-\max\{ P_{i}: i = 0..t\} }{\max\{ P_{i}: i = 0..t\}}$ 表示价格序列在$t$时刻的多头方以及空头方的最大回撤值。$\s(N_{B},P)$ 表示价格序列$P$周期为$N_{B}$的波动率，此模型中$N_{B} = N$

多开的条件有三个，需要同时满足
\begin{enumerate}
\item 斜率大于阈值$\a^*_{t} > \a_{m} $
\item 最近两日价格在拟合曲线两侧$\D_{t}>0>\D_{t-1}$
\item 最大回撤参数小于阈值$\th^l_{t} <\Th$
\end{enumerate}

多平的条件有两个，满足其中一个即可
\begin{enumerate}
\item 斜率小于零$\a^*_{t} <0 $
\item 拟合曲线突破布林带上轨 $\D_{t} > n \s_{t}(N,P)$
\end{enumerate}

空开的条件有三个，需要同时满足
\begin{enumerate}
\item 斜率小于阈值$\a^*_{t} < \a_{m} $
\item 最近两日价格在拟合曲线两侧$\D_{t}<0<\D_{t-1}$
\item 最大回撤参数小于阈值$\th^s_{t} <\Th$
\end{enumerate}

空平的条件有两个，满足其中一个即可
\begin{enumerate}
\item 斜率大于零$\a^*_{t} >0 $
\item 拟合曲线突破布林带下轨 $\D_{t} < -n \s_{t}(N,P)$
\end{enumerate}

策略参数为$\left(N, n, \a_{m}, \Th\right)$

\subsection{布林线策略}
\subsubsection{概述}
布林线指标，即BOLL指标，其英文全称是“Bollinger Bands”，布林线利用统计原理，求出股价的标准差及其信赖区间，从而确定股价的波动范围及未来走势，利用波带显示股价的安全高低价位，因而也被称为布林带。其上下限范围不固定，随股价的滚动而变化。布林指标属路径指标，股价波动在上限和下限的区间之内，这条带状区的宽窄，随着股价波动幅度的大小而变化，股价涨跌幅度加大时，带状区变宽，涨跌幅度狭小盘整时，带状区则变窄。

\subsubsection{策略算法}

用$P^o,P^h,P^l,P^c$来表示价格的开盘，最高价，最低价和收盘价,用$B_{u},B_{l}$表示布林带的上下轨，$\MA(N,P)$ 表示周期为$N$ 的基于序列$P$ 的移动平均线，$\s$ 表示价格序列的波动率, 那么布林线表示为
\begin{eqnarray*}
B^u_{t}(N_{B},P) &=& \MA_{t}(N_{B},P) + n \s_{t}(N_{B},P) \\
B^l_{t}(N_{B},P) &=& \MA_{t}(N_{B},P) - n \s_{t}(N_{B},P)
\end{eqnarray*}

多开的条件有三个，需要同时满足
\begin{enumerate}
\item 当日最高价$P^h_{t}>B^u_{t}(N_{B},P^c) $
\item 当日收盘价$P^c_{t}>\max \{P^{c}_{t}: t \in \left[-N_{c}, 0 \right]\}$
\item 当日布林带宽度满足$ \frac{ B^u_{t}(N_{B},P) - B^l_{t}(N_{B},P) }{P^c_{t}} > \frac{N_{s}}{1000}$
\end{enumerate}

多平的条件有两个，需要同时满足
\begin{enumerate}
\item 当日收盘价$P^c_{t}<\MA(N^*_{C},P^{c})$
\item 当日均线 $\MA(N_{C},P^{c})< B^u_{t}(N_{B},P^c)$
\end{enumerate}


空开的条件有两个，需要同时满足
\begin{enumerate}
\item 当日最低价$P^l_{t}<B^u_{l}(N_{B},P^c)$
\item 当日收盘价 $P^c_{t}<\min \{P^{c}_{t}: t \in \left[-N_{c}, 0 \right]\}$
\end{enumerate}

空平的条件有两个，需要同时满足
\begin{enumerate}
\item 当日收盘价$P^c_{t} > \MA(N^*_{C},P^{c})$
\item 当日均线 $\MA(N_{C},P^{c})> B^u_{t}(N_{B},P^c)$
\end{enumerate}

策略参数为$\left( N_{B},n,N_{c},N^*_{c},N_{s}\right)$ \footnote{在代码中分别对应参数名bollingerlength, numStdDev, closelength, malength, space}


\fontsize{9}{11}
\selectfont

[支持向量机通俗导论， http://blog.csdn.net/v$\_$july$\_$v/article/details/7624837， 2012]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}
\subsection{SVM策略}
\subsubsection{概述}

支持向量机(Support Vector Machine, 简称SVM)是一种二类分类模型，其基本模型定义为特征空间上的间隔最大的线性分类器，其学习策略便是间隔最大化，最终可转化为一个凸二次规划问题的求解。

由于SVM独特的机制和效果，它在解决小样本、非线性以及高纬模式识别中体现出许多优势，利用SVM 技术针对市场指数来建立择时模型，可以有效地避免传统回归模型的精度和扩展性问题


\subsubsection{算法}


\begin{equation}
 \left(  \begin{array}{cccc} F^1_{1}  &F^2_{1}&...& F^N_{1}\\ F^1_{2} & F^2_{2}&...& F^N_{2}\\.&.&.&.\\F^1_{M}&  F^2_{M}&...& F^N_{M}   \end{array} \right) \Longrightarrow   \left(  \begin{array}{c} R_{1} \\R_{2}\\...\\R_{M} \end{array}   \right)
\label{SVMMain}
\end{equation}





\subsection{中证100动量策略-大盘策略}
\subsubsection{概述}
中证100动量策略-大盘策略，交易标的为中证100指数，策略当指数长期和单日超额收益率达到相应阈值时做多；当长期和单日超额收益率低于相应阈值时做空。

\subsubsection{算法}
用$R^{zz100}_{t,n}$来表示$t$日中证100指数$n$日的收益率；$R^{hs100}_{t,n}$来表示$t$ 日沪深300指数$n$日的收益率；$Q^{zz100}_{t,n}$来表示$t$日中证100指数相对沪深300指数$n$日超额收益分位数；$R$ 表示单笔交易所获得的收益；$T$ 表示单笔交易持有的天数。

\paragraph{开仓条件}共有三项条件需同时满足：
\begin{enumerate}
  \item 前日中证100指数20日超额收益率分位数
  $Q^{zz100}_{t-1,20}<0.1$；
  \item 当日中证100指数20日超额收益率分位数
  $Q^{zz100}_{t,20}>0.1$

  或  当日中证100指数20日超额收益率分位数大于三日内最小值：

  $Q^{zz100}_{t,20}-min(Q^{zz100}_{t,20},Q^{zz100}_{t-1,20},Q^{zz100}_{t-2,20})>0.03$；
  \item 当日指数1日超额收益率
  $R^{zz100}_{t,1}-R^{hs100}_{t,1}>0.5\%$。
\end{enumerate}

\paragraph{平仓条件}有两组条件满足其一即可：

第一组条件为：
\begin{enumerate}
  \item 前日中证100指数20日超额收益率分位数
  $Q^{zz100}_{t-1,20}>0.75$
  \item 当日中证100指数20日超额收益率分位数
  $Q^{zz100}_{t,20}<0.75$
  \item 当日指数1日超额收益率
  $R^{zz100}_{t,1}-R^{hs100}_{t,1}<-0.5\%$。
\end{enumerate}

第二组条件为：
\begin{enumerate}
  \item 该笔交易达到最长持有期限$T\leq30$
\end{enumerate}

\paragraph{止盈/止损条件}
\begin{enumerate}
  \item 该笔交易收益 $R>10\%$时，执行止盈操作；
  \item 该笔交易收益 $R<-5\%$时，执行止损操作。
\end{enumerate}


\subsection{中证500动量策略-双均线策略}
\subsubsection{概述}
中证500动量策略-双均线策略是一种趋势交易策略。策略在短期超额收益率超过长期超额收益率时做多，短期超额收益率低于长期超额收益率时做空。

\subsubsection{算法}
用$R^{zz100}_{t,n}$来表示$t$日中证100指数$n$日的收益率；$R^{hs100}_{t,n}$来表示$t$ 日沪深300指数$n$日的收益率；$R$ 表示单笔交易所获得的收益；$T$ 表示单笔交易持有的天数。

\paragraph{开仓条件} 共有三个条件需同时满足：
\begin{enumerate}
  \item 前日中证100指数10日超额收益$R^{zz100}_{t-1,10}-R^{hs100}_{t-1,10}>R^{zz100}_{t-1,3}-R^{hs100}_{t-1,3}$;
  \item 当日中证100指数10日超额收益$R^{zz100}_{t,10}-R^{hs100}_{t,10}<R^{zz100}_{t,3}-R^{hs100}_{t,3}$;
  \item 当日中证100指数1日超额收益$R^{zz100}_{t,1}-R^{hs100}_{t,1}>0.5\%$
\end{enumerate}


\paragraph{平仓条件} 有两组条件满足其一即可：

第一组条件为：
\begin{enumerate}
  \item 前日中证100指数5日超额收益$R^{zz100}_{t-1,5}-R^{hs100}_{t-1,5}>R^{zz100}_{t-1,20}-R^{hs100}_{t-1,20}$;
  \item 当日中证100指数20日超额收益$R^{zz100}_{t,5}-R^{hs100}_{t,5}<R^{zz100}_{t,20}-R^{hs100}_{t,20}$;
\end{enumerate}

第二组条件为：
\begin{enumerate}
  \item 该笔交易达到最长持有期限$T\leq29$
\end{enumerate}

\paragraph{止盈/止损条件}
\begin{enumerate}
  \item 该笔交易收益 $R>20\%$时，执行止盈操作；
  \item 该笔交易收益 $R<-3\%$时，执行止损操作。
\end{enumerate}


\newpage
\section{衍生品对冲策略}


\fontsize{9}{11}
\selectfont

[动态复制看涨期权OBPI策略，\emph{提云涛}、\emph{蒋俊阳}，申万证券，2010]


\fontsize{10}{11}
\selectfont
\vspace{0.5cm}


\subsection{保本型结构化产品}
保本型结构化产品的收益来自本金收益和浮动收益：
\begin{itemize}
\item 本金收益：大部分资金投资债券组合或者其他无风险资产实现到期收回本金。同时有的合约也会保息，即基于本金允诺一定的利率。
\item 浮动收益：利用股票或者股指期货和债券复制买入期权，从而实现市场波动带来的潜在收益
\end{itemize}
值得注意的是，与股票相比，由于股指期货用保证金进行杠杆交易，因此在相同市值的风险资产所占用的资金较少，当用股指期货复制期权时，剩余资金还可以进行绝对收益的投资，进一步增加收益。



\subsection{定价和对冲}
\subsubsection{符号假设}
假设这一结构化产品合约到期日为$T$, $B_{0}$ 为本金中固定收益部分的初始投资额,$G$为保本率,$r_{s}$ 为允诺给客户的利率, $r_{f}$为固定收益部分投资的收益，其中必须满足$r_{f}>r_{s}$。


另外假设$P$为参与率（详见\ref{ParticipationRate}），标的为股票指数 $S_{t}$，浮动收益是股票指数到期时涨跌幅$\left(\frac{S_{T}}{S_{t}}-1\right)$ 的函数。内嵌期权合约期内价值为$C(S_{t})$, $t \le T$.


\subsubsection{产品分解}
对于任意时刻$t \ge 0$,此结构化产品组合本金$A_{t}$实际上可以分解成一个债券和若干期权的组合。
\begin{eqnarray}
A_{t} &=& A_{bond} + A_{opt}  \nonumber \\
&=& B_{0}*\left(1+r_{f}t\right) + A_{0}*P*C(S_{t})
\label{StructureFormula}
\end{eqnarray}


\subsubsection{期权定价}
对于路径依赖或者无显式解的期权需要用蒙特卡洛模拟的方法来定价。简单期权用BS公式。

\subsubsection{固定收益本金}
投资于固定收益资产的本金$B_{0}$必须保证到期时能够获得整个产品的约定固定收益，即$A_{0}*G*\left( 1 + r_{s}T\right)$, 所以可得
\begin{eqnarray}
B_{0}= A_{0}*G*\frac{\left( 1 + r_{s}T\right)}{\left( 1 + r_{f}T\right)}
\label{FIBenjin}
\end{eqnarray}

\subsubsection{参与率计算}
\label{ParticipationRate}
参与率指结构化产品中期权部分相对于挂钩资产的变动情况，投资者实际可以得到的收益率比例，例如参与率为80\%，则挂钩资产价格上升30\%，投资者便可以得到30\%*80=24\%的回报。一般来说参与率与保本率成反比关系，保本率越高，可以动用的资金用作参与买卖挂钩资产的比率越低，参与率也随之降低。

令(\ref{StructureFormula})中$t=0$， 将(\ref{FIBenjin})代入(\ref{StructureFormula}) 得到
\begin{eqnarray*}
A_{0} = A_{0}*P*C(S_{0}) +A_{0}*G*\frac{\left( 1 + r_{s}T\right)}{\left( 1 + r_{f}T\right)}
\end{eqnarray*}
可得
\begin{eqnarray}
P = \left(1 - G*\frac{\left( 1 + r_{s}T\right)}{\left( 1 + r_{f}T\right)}\right)/C(S_{0})
\label{Canyvlv}
\end{eqnarray}

比如，产品期限$T=0.5$ (6个月)，保本$G=100\%$, 期权价格为$1\%$(相对于本金为$100$), 保证客户利息$r_{s} = 3\%$, 产品管理人固定收益投资收益率$r_{f} = 4.5\%$,则$P\approx 70\%$。 此处假设没有任何其他费用(如销售服务费，管理费和托管费等)，考虑这些费用的情况下，参与率将低于此数值。


\subsubsection{基于股指期货的衍生品复制策略}
基于股指期货的衍生品复制策略是指利用股指期货合约作为标的来复制衍生品合约的Delta头寸，同时通过持有债券来复制剩余的头寸。

%用$C_{t},V_{t},F_{t},B_{t}$来表示$t$时刻的复制衍生品总资产，期货头寸，期货占用资金以及债券头寸, $\Delta_{t}= \frac{\partial f_{t}}{ \partial F_{t}}$ 表示$t$ 时刻衍生品的Delta值\footnote{值得注意的是理论上$\Delta_{F_{t}}=\Delta_{S_{t}}\frac{\partial S_{t}}{\partial F_{t}}$, 部分研究会假设$\frac{\partial S_{t}}{\partial F_{t}} = 1$, 即$\Delta_{F_{t}}=\Delta_{S_{t}}$， 因为从日数据来看，$\frac{\partial S_{t}}{\partial F_{t}} = \frac{\Delta S_{t}}{\Delta F_{t}}=\frac{S_{t+1}-S_{t}}{F_{t+1}-F_{t}}$, 历史上的基差变化都很不稳定，故认为基差变化率为1}。

%用$\lambda$ 和$\theta$ 表示保证金比例以及期货资金账户中期货仓位（=合约占用保证金/合约占用保证金加上期货账户自由资金）

%在$t=0$时刻,初始总资产 $C_{0} = 100$,其中
%\begin{itemize}
%\item 持有的期货合约价值$V_{0}= P\Delta_{t}C_{0}$，期货资金使用$F_{0}= P*\Delta_{t}C_{0}*\frac{\lambda}{\th}$
%\item 持有的债券合约价值$B_{0}= 100  - F_{0}$
%\end{itemize}

%从$t$到$t+1$时刻,总资产变成 $C_{t+1} = F_{t}+V_{t}\left(\frac{S_{t+1}}{S_{t}}-1 \right)+B_{t}*e^{r\Delta t}$,此刻\footnote{假设股指和期指走势一致}
%\begin{itemize}
%\item 持有的期货合约调整$\Delta V_{t+1}= P C_{0}(\Delta_{t+1}-\Delta_{t})$，期货资金使用$F_{t+1}= P*\Delta_{t+1}C_{0}*\frac{\lambda}{\th}$
%\item 持有的债券合约调整$\Delta B_{t+1}= B_{t+1} - B_{t}$,使得持有的债券合约价值为$B_{t+1} = C_{t+1} - F_{t+1}$.
%\end{itemize}

%在到期日$T$时刻，$C_{T} = F_{T-1}+V_{T-1}\left(\frac{S_{T-1}}{S_{T}}-1 \right)+B_{T-1}*e^{r\Delta t}$

\emph{阿拉丁}程序库中函数\emph{}可以计算任意期权进行Delta复制的成本，具体算法如下。

假设在初始时刻$t=0$，交易费率为$c$， 为了复制期权，需要在股票账户购入$\Delta_{0}S_{0}$，同时在现金账户借入$\left(\Delta_{0}S_{0}+\left| \Delta_{0}S_{0} \right|c\right)$作为购买标的的资金以及覆盖此次交易的费用。初始时刻资产组合价值可表示
\begin{eqnarray*}
V_{0}=\Delta_{0}S_{0} - \left(\Delta_{0}S_{0}-\left| \Delta_{0}\right|S_{0} c  \right)
\end{eqnarray*}

假设下一个头寸调整(rebalance)时刻为$t=t_{1}$, 并且$t_{1}-t_{0}=\Delta t$，此时标的价格变化至$S_{1}$。此时初始时刻购入持有的标的价值已经变化为$\Delta_{0}S_{1}$
\begin{itemize}
\item 此刻需要把股票账户持有的标的调整为$\Delta_{1}S_{1}$,调整头寸得到的$\left(\Delta_{0} - \Delta_{1} \right)S_{1}$放入现金账户。
\item 调整头寸会造成$\left| \Delta_{1}\right|S_{1} c$ 交易成本，这部分也算入现金账户
\item 现金账户中初始时刻$t=0$借入的资金累计了利息，连本带息总价值为
$\left(\Delta_{0}S_{0}+\left| \Delta_{0}\right|S_{0} c\right)e^{\Delta t}$

\end{itemize}
故在时刻$t=t_{1}$，资产组合价值为
\begin{eqnarray*}
V_{1}(S_{0},S_{1})=\Delta_{1}S_{1} - \left(\Delta_{0}S_{0}+\left| \Delta_{0}\right|S_{0} c\right)e^{\Delta t}+\left(\Delta_{0} - \Delta_{1} \right)S_{1}-\left| \Delta_{1}\right|S_{1} c
\end{eqnarray*}

由此类推，在最后一次调整时刻$t=t_{N-1}$
资产组合价值为
\begin{eqnarray*}
V_{N-1}(S_{0},...,S_{N-1})=\Delta_{N-1}S_{N-1} -  \left(\Delta_{i}+\left|  \Delta_{i}\right|c \right)S_{i}e^{(N-1-i)\Delta t}+ \sum\limits_{i=0}^{N-2} \left(\Delta_{i} - \Delta_{i+1}-\left|  \Delta_{i+1}\right|c \right)S_{i+1}e^{(N-2-i)\Delta t}
\end{eqnarray*}

在到期日$t=t_{N}$时,资产组合价值变化为
\begin{eqnarray}
V_{N}(S_{0},...,S_{N})=\Delta_{N-1}S_{N} -  \left(\Delta_{i}+\left|  \Delta_{i}\right|c \right)S_{i}e^{(N-i)\Delta t}+ \sum\limits_{i=0}^{N-2} \left(\Delta_{i} - \Delta_{i+1}-\left|  \Delta_{i+1}\right|c \right)S_{i+1}e^{(N-1-i)\Delta t}
\label{V_N}
\end{eqnarray}

在到期日$t=t_{N}$，该资产组合按照合约需要支付给客户$f(S_{N})$，那么剩下的资产就是这个期权的价值，也是复制成本。注意到公式(\ref{V_N})中的资产组合价值其实是路径依赖的。
假设蒙特卡率模拟使用了$M$条路径，那么期权的复制成本$C(S_{0})$为\footnote{取负号是因为构建初始组合时假设没有投入初始资金，完全依靠借款来购买标的，由此在到期日支付给客
户后的资金缺口就是复制成本}


\begin{eqnarray}
C(S_{0}) = -\sum\limits_{j=1}^{M}\left(  V_{j,N}(S^{j}_{0},...,S^{j}_{N}) -  f(S^j_{N}) \right)
\end{eqnarray}

\subsubsection{特殊的结构化产品}
此类结构化产品的到期收益率$R_{S_{T}}$定义为
\begin{eqnarray*}
R_{S_{T}} = m+g_{1} \mathbf{1}_{S_{0} \le S_{T} \le S_{u}} \left( \frac{S_{T} - S_{0}}{S_{0}} \right)+g_{2} \mathbf{1}_{S_{l} \le S_{T} \le S_{0}} \left( \frac{S_{0} - S_{T}}{S_{0}} \right)
\end{eqnarray*}



\newpage

\section{期货套利策略}
\subsection{商品期货套利策略}


\newpage


\newpage
\section{期权套利策略}
\subsection{符号说明}
$C(K,T)$和$P(K,T)$表示行权价$K$，到期日为$T$ 的欧式看涨期权和看跌期权的价值。$r$表示无风险利率。$M$为期权的保证金。

\subsection{基于平价公式的套利}
\emph{参考文献: 50ETF期权无风险套利指南及仿真实证，周琦，林晓明，2015}
\vspace{0.3cm}

根据无套利原理得到期权平价公式\footnote{平价公式的成立不依赖于定价模型}
\begin{eqnarray}
C(K,T-t)-P(K,T-t) =S_{t}-Ke^{-r(T-t)}
\label{optionpartity}
\end{eqnarray}

\subsubsection{套利原理}
平价公式(\ref{optionpartity})等价于
\begin{eqnarray}
C(K,T-t)-P(K,T-t)-Ke^{-r(T-t)} =S_{t}
\label{optionpartity2}
\end{eqnarray}

等式(\ref{optionpartity2})左侧可以看做合成股票多头，右侧是实际股票价格。现实中平价公式并不总是成立。令
\begin{eqnarray*}
s=C(K,T-t)-P(K,T-t)+Ke^{-r(T-t)} -S_{t}
\end{eqnarray*}

当$s>0$时，合成股票价格大于实际股票价格，可以买入实际股票并同时卖出合成股票进行套利，即正向转换套利。反之为逆向转换套利。

\paragraph{正向转换套利}
实际操作时，需要构建正向套利的头寸为实际股票多头$+$认购期权空头$+$认沽期权多头。

用$\e_{0},\e_{T}$表示初始时刻和到期日时刻的交易费用。那么套利的建仓条件是合成股票价格与实际股票价格的差能够覆盖交易成本\footnote{由于正向转换套利可以利用买入的
股票进行备兑开仓，因此在卖出认购期权时，保证金不需要现金开销}，即
\begin{eqnarray}
C(K,T-t)-P(K,T-t)+Ke^{-r(T-t)} -S_{0}-\e_{0}-\e_{T}e^{-r(T-t)}>0
\label{jiancang}
\end{eqnarray}

套利的平仓条件是当平仓收益超过持有到期收益，即
\begin{eqnarray}
-C(K,T-t)+P(K,T-t)+S_{t}-\e_{t}>\left(K-\e_{T}\right)e^{-r(T-t)}
\label{pingcang}
\end{eqnarray}

等式(\ref{pingcang})可以整理为
\begin{eqnarray}
-C(K,T-t)+P(K,T-t)+S_{t}-\e_{t}-\left(K-\e_{T}\right)e^{-r(T-t)}>0
\label{pingcang2}
\end{eqnarray}

卖出的认购期权为浅度虚值或者平值时，可能出现的套利机会较多。另外在近月合约即将交割时，套利机会出现的可能性也较大。

\paragraph{逆向转换套利} 由于涉及融券卖出，成本较高。市场上套利机会相对少很多。

\paragraph{合成基差套利} 合成基差套利是逆向转换套利的一个变形。当股指期货深度贴水时，可以通过期权合成现货空头，同时做多股指期货来构建基差套利的组合。

根据平价公式(\ref{optionpartity})可知
\begin{eqnarray*}
P(K,T-t) - C(K,T-t) = Ke^{-r(T-t)} -S_{t}
\end{eqnarray*}
意味着可以通过买入认沽期权($P(K,T-t)$),同时卖出认购期权($-C(K,T-t)$)的方式来合成现货空头($-S_{t}$),上述期权合约对应的是同一到期月份以及同一行权价格。


在建仓时刻$t$，套利组合持有一手多头期货，假设当时期货价格为$F_{t}$, 每个期货指数点对应价值为$V_{F}$，则期货多头市值为$V_{F}F_{t}$。另外持有$N$份合成现货空头(期权合约为平值期权)，所以合成空头现货的价值为$N\left(P(K,T-t) - C(K,T-t)\right)$。

如果具体以IH期货为例，单个指数点价值为$V_{F}=300$。一手IH期货对应的50ETF约为$300000$ 份\footnote{IH期货对应的上证50指数约为50ETF的1000倍，一个IH期货的指数点为300元，所以一手IH期货对应的50ETF约为$300000$份。}。因为单张期权合约对应10000股50ETF，说明为构建套利组合，对应一手IH 期货，需要买入30张认沽期权和卖出30 张认购期权。

假设期货和期权到期日相同，那么可以在建仓时刻计算套利组合的预期收益，即
\begin{eqnarray*}
300000K-300F_{t} - 30*10000\left(P(K,T-t) - C(K,T-t)\right)
\end{eqnarray*}

如果把收益表示为建仓时刻单份50ETF价格的百分比，需要把总利润除以$300000S^{50ETF}_{t}$即为
\begin{eqnarray*}
\left( \frac{K}{S^{50ETF}_{t}}-\frac{F_{t}}{1000S^{50ETF}_{t}}-\frac{P(K,T-t) - C(K,T-t)}{ S^{50ETF}_{t}} \right)
\end{eqnarray*}
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[
在到期日，期货多头市值和合成现货空头市值之和变成
\begin{eqnarray*}
300F_{T}+30*10000\left( \max\{K-F^{50ETF}_{T},0\} - \max\{F^{50ETF}_{T}-K,0\} \right)&=&300F_{T}+ 300000\left(K-F^{50ETF}_{T} \right)\\
&=&300F_{T} - 300000F^{50ETF}_{T} + 300000K\\
&\approx &300000K
\end{eqnarray*}

故套利的总预期收益为$300000K-300F_{t} - 30*10000\left(P(K,T-t) - C(K,T-t)\right)$。
]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}


\subsection{箱体套利}
箱体套利实际上是正向转换套利和反向转换套利的组合。即买入一个合成标的并同时卖出一个合成标的，从而获得两者之间的价差。

根据平价公式(\ref{optionpartity})可以得到
\begin{eqnarray}
P(K,T) - C(K,T) = Ke^{-rT} -S_{0}
\end{eqnarray}
意味着可以通过买入认沽期权同时卖出认购期权的方式合成现货多头$-S$




\subsubsection{套利原理}
箱体套利的持仓为认购期权多头1$+$认沽期权空头1$+$ 认购期权空头2$+$认沽期权多头2。

根据平价公式(\ref{optionpartity})可以得到针对两个不同行权价的期权$C(K_{1},T)$ 和$C(K_{2},T)$,
\begin{eqnarray*}
C(K_{1},T)-P(K_{1},T) =S_{0}-K_{1}e^{-rT}\\
C(K_{2},T)-P(K_{2},T) =S_{0}-K_{2}e^{-rT}
\end{eqnarray*}

两式相减得到
\begin{eqnarray}
\left(C(K_{1},T)-P(K_{1},T)+K_{1}e^{-rT}\right)-\left(C(K_{2},T)-P(K_{2},T)+ K_{2}e^{-rT}\right)=0
\label{boxformula}
\end{eqnarray}

当公式(\ref{boxformula})不成立时意味着存在套利机会。

用$\e_{0},\e_{T}$表示初始时刻和到期日时刻的交易费用。那么套利的建仓条件是合成股票价格的价差能够覆盖交易成本（假设合成股票1的价格高于合成股票2），即
\begin{eqnarray}
\left(K_{1}-K_{2}\right)e^{-rT}+\left(C(K_{1},T)-P(K_{1},T)-C(K_{2},T)+P(K_{2},T)\right)-M(1-e^{-rT})-\e_{0}-\e_{T}e^{-rT}>0
\label{jiancang2}
\end{eqnarray}

套利的平仓条件是当平仓收益超过持有到期收益，即
\begin{eqnarray}
\nonumber -\left(K_{1}-K_{2}\right)e^{-r(T-t)}-\left(C(K_{1},T-t)-P(K_{1},T-t)-C(K_{2},T-t)+P(K_{2},T-t)\right)\\
+M(1-e^{-rT})-\e_{t}+\e_{T}e^{-r(T-t)} >0
\end{eqnarray}

箱体套利相对于转换套利的一些优势在于
\begin{itemize}
\item 转换套利的成本往往较高，尤其是反向转换，由于其涉及融券卖出，而当前A股的融券费用较高且融券机制不完善，成本更高。
而箱体套利只需要2份权利金和2份保证金的建仓成本，其建仓成本相对而言要更小些。
\item 箱体套利是基于2个合成现货之间的套利，当一个合成现货被高估，另一个合成现货被低估时，箱体套利相比于转换套利能够获得更高的价差收益。
\end{itemize}

\subsection{凸性套利策略}
\emph{参考文献: 期权凸性套利策略，郑达、周欣炜，信达证券，2014}
\vspace{0.3cm}

凸性套利策略是指利用期权价格是行权价格凸函数的性质进行套利的策略。

\subsubsection{套利原理}
根据凸函数的定义，对于任意$K_{1}<K_{3}$,$0<\lambda<1$可得
\begin{eqnarray}
C(\lambda K_{1} + (1-\lambda) K_{3},T) < \lambda C(K_{1},T) + (1-\lambda) C(K_{3},T)
\label{StrikeFormula1}
\end{eqnarray}

若令
\begin{eqnarray*}
\lambda^{*} K_{1} + (1-\lambda^{*}) K_{3} = K_{2}
\end{eqnarray*}

可以得到 $\lambda^{*} = \frac{ K_{3}- K_{2}}{K_{3}- K_{1}}$。将其带入公式(\ref{StrikeFormula1})，对于任意$K_{1}<K_{2}<K_{3}$,可得
\begin{eqnarray}
C(K_{2},T) < \lambda^{*} C(K_{1},T) + (1-\lambda^{*}) C(K_{3},T)
\label{StrikeFormula2}
\end{eqnarray}

如果用$P(K,T)$来表示行权价$K$，到期日$T$的欧式看跌期权的价值，同理可以得到
\begin{eqnarray}
P(K_{2},T) < \lambda^{*} P(K_{1},T) + (1-\lambda^{*}) P(K_{3},T)
\label{StrikeFormula3}
\end{eqnarray}

理论上欧式看涨期权在任意时刻都必须满足公式(\ref{StrikeFormula2})和(\ref{StrikeFormula3}), 当该公式不满足时，即出现套利机会。

\subsubsection{考虑资金成本的套利}
由上节分析可知，对于任意$K_{1}<K_{3}$,$\lambda^{*} = \frac{ K_{3}- K_{2}}{K_{3}- K_{1}}$，当
\begin{eqnarray}
R= C(K_{2},T) -\lambda^{*} C(K_{1},T)-(1-\lambda^{*}) C(K_{3},T) >0
\label{Arb1}
\end{eqnarray}
或者
\begin{eqnarray}
R= P(K_{2},T) -\lambda^{*} P(K_{1},T)-(1-\lambda^{*}) P(K_{3},T) >0
\label{Arb2}
\end{eqnarray}


当入场套利时，由于保证金占用和交易手续费，会产生一定的资金成本。




\newpage


\section{期权定价模型}






嘉合自行开发的C++库\emph{阿拉丁}主要用来对各式期权进行定价。

\subsection{路径依赖期权}
对路径依赖期权，需要模拟出$N$条路径，针对每条路径判断是否需要敲出，最后把所有路径的最终收益进行平均并折现。

\subsection{减少MC模拟方差的方法}
\fontsize{9}{11}
\selectfont
[Polycopi\'{e} du Probabilit\'{e}s et Finance \`{a} Paris 6，\emph{Gilles Pag\`{e}s},2014]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}
\subsubsection{Control variate}
Control variate方法是指利用一个已知期望值的随机变量来模拟另一个未知的随机变量，以达到减少蒙特卡洛计算中方差的方法。

其原理可以简单描述为，假设两个随机变量$X，X^{*} \in \cL^2_{\R}\left(\Om, \cA, \cP \right)$满足
\begin{eqnarray*}
m = \E X = \E X^{*} \in \cR, \Var(X),\Var(X^{*}),\Var(X-X^{*})>0
\end{eqnarray*}
并且$X,X^{*}$的模拟成本（计算复杂度）相同，那么在蒙特卡洛中应该选择方差较小的随机变量$X^{*}$进行模拟计算。



\begin{theorem}
对于随机变量$X \in \cL^2_{\cR}\left(\Om, \cA, \cP \right)$, 如果存在另一个随机变量$Z \in \cL^2_{\cR}\left(\Om, \cA, \cP \right)$ 满足
\begin{enumerate}
\item $\E Z$ 能够以较小的成本用确定性方法计算出来（显式解，数值方法）
\item $X-Z $ 和$X$的模拟计算成本（复杂度）相同
\item $\Var \left( X-Z \right) < \Var(X) $

\end{enumerate}

那么，随机变量$X^{*} = X +\E Z - Z$ 的模拟计算成本与$X$相同，同时 $\E X^{*} =\E X$和$\Var(X^{*}） = \Var(X-Z)<\Var(X)$。

满足上述三个条件的随机变量$Z$叫做$X$的control variate.
\label{controlvariate}
\end{theorem}

基于定理\textrm{\ref{controlvariate}}， 可以进一步定义$X^{*} = X +\b（\E Z - Z)$. 通过估计$\b$可以进一步减小方差。
\vspace{0.5cm}
\fontsize{9}{11}
\selectfont


[根据定义$X^{*} = X +\b（\E Z - Z)$，可以得到方差的关系式
\begin{eqnarray}
\Var(X^{*}，\b) = \Var(X) + 2\b \Cov(X,\E Z - Z) + \b^{2}\Var(\E Z - Z)
\label{ControlvariateAppen1}
\end{eqnarray}

 $\Var(x,\b)$是$\b$连续凸函数，故$\Var(X^{*},\b)$对$\b$一阶偏导数为零时即为其最小值。由(\ref{ControlvariateAppen1})式可得
\begin{eqnarray}
\b^{*} = - \frac{\Cov(X,\E Z - Z)}{\Var(\E Z - Z)}
\label{ControlvariateAppen2}
\end{eqnarray}
]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}



在蒙特卡洛方法中，$X$是最初要通过模拟来估计的变量，$Z$是control variate，通过估计$Z$来间接估计$X$. 如定理\textrm{\ref{controlvariate}} 所述， 变量$Z$ 需要有精确解（显式表达式或者其他数值解）。

当应用与期权定价时，选择control variate可以描述为
\begin{enumerate}
\item 与目标函数对应同样标的物，并且其期望值已知
\item 与目标函数高度相关
\end{enumerate}


Control variate举例
\begin{enumerate}
\item 普通欧式期权: 通常可以用ATM期权作为control variate.

假设要为一个欧式看跌期权估价。用$C_{BS}(S_{t}，K,t)$表示$t$时刻BS模型看涨期权的价格，用$\Ch(S_{t}，K,t)$，$\Ph(S_{t}，K,t)$表示蒙特卡洛模拟得到的看涨和看跌期权价格
 \begin{eqnarray*}
\Ch(S_{t}，K,t)&=& e^{-r(T-t)}\left( \sum\limits_{i=1}^{N} \max(0,S_{T,i}-K) \right) \\
\Ph(S_{t}，K,t)&=& e^{-r(T-t)}\left( \sum\limits_{i=1}^{N} \max(0,K-S_{T,i}) \right)
\end{eqnarray*}

则看跌期权的价值可以通过如下公式计算所得
 \begin{eqnarray*}
\Ph^{*}(S_{t}，K,t)&=& \Ph(S_{t}，K,t)+\left(C_{BS}(S_{t}，S_{t},t)-\Ch(S_{t}，S_{t},t) \right)
\end{eqnarray*}



\end{enumerate}



\subsubsection{Antithetic}


\subsection{期权的对冲模型}

\fontsize{9}{11}
\selectfont
[Delta Hedging, Volatility Arbitrage and Optimal Portfolios，\emph{Riaz Ahmad, Paul Wilmott}, 2011]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}


\subsubsection{符号说明与假设}

用$T$表示到期日, $S_{t}$ 表示标的物价格演变的过程, $t\in \lbrack
t_{0},T]$ , $K$ 为行权价, $r$ 为无风险利率。


假设标的物价格$S_{t}$在风险中性测度下服从
\begin{eqnarray*}
dS_{t}=\mu S_{t}dt+\sigma S_{t}dW_{t}
\end{eqnarray*}
其中$\mu $ 为风险中性测度下$S_{t}$的偏移度, $\sigma $ 为实际波动率\footnote{也有叫做历史波动率，英文为realized volatility}。$q$
为连续股息率, $\,(W_{t})_{t\in \lbrack t_{0},T]}$ 为风险中性测度下的布朗运动。用$\widetilde{\sigma }$ 表示隐含波动率。假设 $\sigma $ 和$\widetilde{\sigma }$ 均为常数。

用$V_{t_{0}}^{a}，V_{t_{0}}^{i}$表示在$t_{0}$ 时刻用(Black-Scholes模型)实际波动率和隐含波动率定价的期权的价格。

用$\Delta ^{a},\Delta ^{i}$分别表示使用(Black-Scholes模型)实际波动率和隐含波动率计算的Delta。



\subsubsection{Delta对冲： 实际波动率 与隐含波动率}

假设存在一个\emph{自融资}资产组合，构建了期权Delta对冲的头寸。关于使用实际波动率和隐含波动率进行Delta对冲存在如下数学定理，证明见章节(\ref{DeltaHedge})
\begin{theorem}
用实际波动率进行Delta对冲的最终收益等于用实际波动率和隐含波动率定价的期权的价值之差，即
\begin{eqnarray*}
V_{t_{0}}^{a}-V_{t_{0}}^{i}
\end{eqnarray*}
\label{VolThem1}
\end{theorem}

\begin{theorem}
用实际波动率进行Delta对冲的逐日盯市收益为
\begin{eqnarray}
\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma } ^{2})S_{t}^{2}%
\Gamma ^{i}dt+(\Delta ^{i}-\Delta ^{a})((\mu -r+q)S_{t}dt+\sigma
S_{t}dW_{t})
\label{Hedge_ActVol_PnL}
\end{eqnarray}
而用隐含波动率进行Delta对冲的逐日盯市收益为
\begin{eqnarray}
\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma }^{2})
\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{i}dt
\label{Hedge_ImpVol_PnL}
\end{eqnarray}
\label{VolThem2}
\end{theorem}

这两个定理阐明了一些重要的结论
\begin{itemize}
\item 如果用实际波动率对冲
\begin{enumerate}
\item 那么获得的最终收益是确定的，但是收益曲线的路径是随机(公式(\ref{Hedge_ActVol_PnL})中的逐日盯市收益中有随机项)。
\item 公式(\ref{Hedge_ActVol_PnL})说明对冲策略的收益实现的路径还受到偏移率$\mu$的影响
\item 如果实际波动率大于隐含波动率，那么对冲策略的收益为正
\item 图(\ref{FigActVol})显示的是利用实际波动率进行对冲的模拟PnL实现路径图:最终的PnL 收敛于一个范围内，各条路径最终的PnL 不完全相同是因为对冲是"离散的"而不是理论意义上的连续对冲
\end{enumerate}

\item 如果用隐含波动率对冲
\begin{enumerate}
\item 最终的收益是不确定的， 但是收益曲线是确定的过程(deterministic process, 公式(\ref{Hedge_ImpVol_PnL})中的逐日盯市收益中没有随机项)。
\item 图(\ref{FigImpliedVol})是针对使用隐含波动率进行对冲的PnL图。  每条PnL的实现路径的波动性要比图(\ref{FigActVol}) 中小很多。从风险控制的角度这是一个好的策略。相比于用实际波动率对冲，用隐含波动率对冲的优势在于根本不需要知道当前实际波动率是多少。如果要实现盈利，只需要确保实际波动率比隐含波动率大(如果是期权多头)或者小(如果是期权空头)
\end{enumerate}
\end{itemize}

相比之下利用隐含波动率对冲的实现路径确定性较高，但是最终收益是不确定的。

\begin{figure}[H]
  \begin{center}
    \leavevmode
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{PnL_hedge_actvol}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{PnL_hedge_actvol}
    \fi
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{PnL_hedge_actvol_put}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{PnL_hedge_actvol_put}
    \fi
    \caption{用实际波动率进行Delta动态对冲的ATM 期权头寸PnL走势图(实际波动率$40\%$,隐含波动率$25\%$). (a)图中为看涨期权, (b)图中为看跌期权}
    \label{FigActVol}
  \end{center}
\end{figure}




\begin{figure}[H]
  \begin{center}
    \leavevmode
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{PnL_hedge_impvol}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{PnL_hedge_impvol}
    \fi
    \subfigure[]
    \ifpdf
      \includegraphics[height=3in,width=3in]{PnL_hedge_impvol_put}
    \else
      \includegraphics[bb = 92 86 545 742, height=6in]{PnL_hedge_impvol_put}
    \fi
    \caption{用隐含波动率进行Delta动态对冲的ATM 期权头寸PnL走势图(实际波动率$40\%$,隐含波动率$25\%$). (a)图中为看涨期权, (b)图中为看跌期权}
    \label{FigImpliedVol}
  \end{center}
\end{figure}



\begin{theorem}
Carr(2005) 和 Henrard(2003) 提出了针对使用任意波动率$\delta_{h}$进行Delta对冲的更普通的结果，该对冲策略的收益为
\begin{eqnarray*}
V_{t_{0}}^{h}-V_{t_{0}}^{i}+\frac{1}{2}(\sigma ^{2}-\sigma
_{h}^{2})\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{h}dt
\end{eqnarray*}
最大的收益发生在路径
\begin{eqnarray*}
S_{t}=K\exp (-(r-q-\frac{\sigma _{h}^{2}}{2}%
)(T-t))
\end{eqnarray*}
\label{VolThem3}
\end{theorem}

\begin{theorem}
使用隐含波动率进行Delta对冲的期望收益为
\begin{eqnarray*}
\begin{split}
&F(S_{0},t_{0})=\frac{Ke^{-r(T-t_{0})}(\sigma ^{2}-\overset{\thicksim }{%
\sigma }^{2})}{2\sqrt{2\pi }}\int_{t_{0}}^{T}\frac{1}{\sigma ^{2}(s-t_{0})+%
\overset{\thicksim }{\sigma }^{2}(T-s)}\\&
\exp (-\frac{(\ln (S_{0}/K)+(\mu -%
\frac{1}{2}\sigma ^{2})(s-t_{0})+(r-q-\frac{1}{2}\sigma ^{2})(T-s))^{2}}{%
2(\sigma ^{2}(s-t_{0})+\overset{\thicksim }{\sigma }^{2}(T-s))})ds
\end{split}
\end{eqnarray*}
\end{theorem}





\newpage
\section{C++量化分析库}
\fontsize{9}{11}
\selectfont
[www.quantlib.org]

[C++ Design Patterns and Derivatives Pricing, \emph{Mark Joshi}, 2004]

[Excel Add in Development in C and C++: Application in Finance, \emph{Steve Dalton},2005]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}



\subsection{C++面向对象编程的基本原则}

\subsubsection{类的使用}
\emph{类(class)}体现了面向对象编程的重要特征。使用类的概念主要有以下几个优势。
\begin{itemize}
\item类可以封装重要的信息，这些封装好的信息可以方便的用在其他地方。比如一个关于利率曲线的类，可以重复的用于各类固定收益产品的定价。重复使用这些类一方面是对这些代码的不断测试和
调试，使其不断完善，另一方面极大节省了时间和提高效率
\item 代码可读性更强。一个类能封装了相关的重要信息，便于理解其代码的含义
\item类把接口（interface）和实现（implementation）分开。使用者只需要知道如果使用这个类（即明白如何试用interface)，而不需要明白其内部是如何工作的（即类的implementation）。
如此一来，在不改变其他代码的情况下，类的implementation可以被改变。实际工作中首先可以写个简单的implementation，随后再不断改进，同时不需要修改任何使用到这个类的代码。
另外，我们可以针对同样的interface在不需要改变任何使用到这个interface代码的情况下编写不同的类implementation（即派生类）
\end{itemize}

\subsubsection{开放-封闭原则}
开放-封闭原则（Open-closed principle）中，开放是指代码要有延展性，所提供的功能要能够逐步丰富（比如一个期权的类能够轻易添加新的payoff。封闭是指在代码中添加功能的时候不需要修改任何已有的代码。在C++中，
继承和虚函数的应用正是体现了这一原则

\subsubsection{虚函数和继承}
\fontsize{9}{11}
\selectfont
[http://my.oschina.net/u/214941/blog/61701]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

虚函数的地址在runtime确定而不是compile time。 具体而言，每个有虚函数定义的类的对象会被编译器插入一段数据，并创建一个表。这段数据叫做vptr指针，指向那个表。那个表叫做虚函数表(vtbl)，每个类都有自己的vtbl，vtbl的作用就是
保存自己类中所有虚函数的地址，我们可以把vtbl 形象地看成一个数组，这个数组的每个元素存放的就是虚函数的地址。当程序运行遇到虚函数时，程序会检查虚函数表(vbtl)然后执行对应的那个虚函数。

虚函数的功能类似于函数指针，但是相比于函数指针，虚函数的使用相对简单明了，而且使得代码结构更加清晰。比如针对Payoff class 通过继承和虚函数可以建立一个包含更多信息的CallPayoff class。如果不这样做，比如在C环境下，可行的做法就是建立一个包含指向Call Payoff函数指针的payoff对象。相比之下前者的方法要简洁直观的多。另外通过不断继承，虚函数包含的信息可以不断变化和丰富，比如创建更复杂的Payoff class。

\emph{纯虚函数}是指在基类中没有被定义的虚函数，其必须要在派生类中得到定义。

含有虚函数的派生类需要引用传递。 比如
\begin{verbatim}
//definition
double MC(const Payoff& thePayoff)
{...}

//call MC
MC(CallPayOff);
\end{verbatim}

如果MC 的参数为值传递（即没有$\&$ ) ，那么针对callPayOff对象，编译器只会使用基类payoff拷贝构造函数，产生一个基类的对象，而不是派生类callPayoff 的对象，这并不是使用者的本意。

\subsubsection{指向派生类的基类指针}

指向派生类的基类指针是指
\begin{verbatim}
PayOff* thePayOffPtr = new PayOffCall（strike）

//call MC
MC(*thePayOffPtr)
\end{verbatim}

（*thePayOffPtr) 其实是一个派生类的对象，作为参数传递给MC

\subsubsection{Rule of Three}
\emph{Rule of three} 是指赋值运算重载函数（$=$），拷贝构造函数和析构函数，（除去默认的定义）如果类需要重新定义其中任意一个，则三者都需要定义。通常情况下，此类函数的重新定义都涉及到处理深拷贝（deep copy），即内存管理问题。合理的定义此类函数可以避免因为内存处理不当造成的异常。

\subsubsection{桥模式(Bridge Pattern)}
在桥接模式结构图中包含如下几个角色：
\begin{itemize}
\item \emph{抽象类(Abstraction)} 用于定义抽象类的接口，它一般是抽象类而不是接口，其中定义了一个Implementor（实现类接口）类型的对象并可以维护该对象，它与Implementor 之间具有关联关系，它既可以包含抽象业务方法，
也可以包含具体业务方法。
\item \emph{扩充抽象类(RefinedAbstraction)} 扩充由Abstraction定义的接口，通常情况下它不再是抽象类而是具体类，它实现了在Abstraction中声明的抽象业务方法，在RefinedAbstraction中可以调用在Implementor 中定义的业务方法。

\item \emph{实现类接口(Implementor)}
定义实现类的接口，这个接口不一定要与Abstraction的接口完全一致，事实上这两个接口可以完全不同，一般而言，Implementor 接口仅提供基本操作，而Abstraction定义的接口可能会做更多更复杂的操作。
Implementor接口对这些基本操作进行了声明，而具体实现交给其子类。通过关联关系，在Abstraction 中不仅拥有自己的方法，还可以调用到Implementor 中定义的方法，使用关联关系来替代继承关系。

\item \emph{具体实现类(ConcreteImplementor)} 具体实现Implementor接口，在不同的ConcreteImplementor中提供基本操作的不同实现，在程序运行时，ConcreteImplementor 对象将替换其父类对象，提供给抽象类具体的业务操作方法。

\end{itemize}

桥模式可以通过以下例子来演示\footnote{代码案例取自Mark Joshi, C++ Design Patterns and Derivatives Pricing, 2004, P59-65}。比如针对蒙特卡洛的定价程序需要定义个函数计算每条路上的价格积分，那么首先定义一个ParametersInner的抽象类

\begin{verbatim}
class ParametersInner
{
public:
    ...
    virtual double integral(double time1, double time2) const = 0;
}
\end{verbatim}

最普通的情况是价格为常数，那么可以定义一个扩充抽象类ParametersConstant（继承自ParametersInner）来计算当价格是常数的情况。

\begin{verbatim}
class ParametersConstant: public ParametersInner
{
public:
    ...
    virtual double integral(double time1, double time2) const;
}

\end{verbatim}


同时定义一个实现类接口Parameters，他的私有成员是指向ParametersInner的指针InnerObjPtr，另外他有一个计算积分的成员函数，调用私有指针成员InnerObjPtr的计算积分的函数。
\begin{verbatim}
class Parameters
{
public:
    ...
    inline double integral(double time1, double time2)
    const{return InnerObjPtr->Integral(time1, time2);};
private:
    ParametersInner* InnerObjPtr;
}

\end{verbatim}

具体实现类是指在蒙特卡洛模拟中提供了具体计算这个积分的方法，如下代码所示。

\begin{verbatim}
double MC(const Parameters& vol, double T)
{
    double variance = vol.Integral(0,T);
    ...
}
ParametersConstant volParam(0.2);
MC(volParam，1.0);

\end{verbatim}

在使用桥接模式时，我们首先应该识别出一个类所具有的两个独立变化的维度，将它们设计为两个独立的继承等级结构，为两个维度都提供抽象层，并建立抽象耦合。
通常情况下，我们将具有两个独立变化维度的类的一些普通业务方法和与之关系最密切的维度设计为"抽象类"层次结构（抽象部分），而将另一个维度设计为"实现类"层次结构（实现部分）。

\subsection{嘉合阿拉丁程序库的编译和使用}

\emph{阿拉丁}系统是嘉合量化投资部内部自行开发的基于开源库\emph{QuantlibXL}的C++程序库。它包含了\emph{Quantlib}自带的金融分析库（衍生品定价，现金流计算，计量以及功能性函数）以及
在此基础之上开发的新的函数（目前主要是结构化衍生品定价的函数）。

编译阿拉丁库生成的\emph{xll}文件作为外部插件在EXCEL中使用，构成了嘉合量化投资部的基于EXCEL的模板分析库\emph{秦皇岛}。

\subsubsection{阿拉丁的编译}
\fontsize{9}{11}
\selectfont
[http://quantlib.org/quantlibxl/]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}


阿拉丁的编译(与\emph{QuantlibXL}基本相同)主要有以下几步
\begin{itemize}
\item 安装和编译boost库\footnote{在使用bjam install命令时，需要注意一般设置 “link$=$static runtime-link$=$static variant$=$release/debug”， release 和debug 安装的文件各自保存在不同文件夹内，其分别对应了release和debug模式下的lib 文件。随后在QuantlibXL编译的时候release和debug模式会各自引用对应版本的boost库}
\item 在相关工程的属性中加入\emph{boost} 库的引用
\item 安装\emph{Python2.6}以上版本
\end{itemize}

阿拉丁中含有十个工程，每个工程的大致功能如下
\begin{itemize}
\item \emph{apr}和 \emph{aprutil} 是整个solution的底层工程，一般不需要修改
\item \emph{log4cxx} 主要负责编译过程中信息的记录(log)，一般也不需要修改
\item \emph{ohgensrc} 用于生成\emph{ObjectHandler}对象的接口，这些对象主要涉及功能性的函数，比如字符串排序和清理等等，不涉及具体的数学运算。该工程包括了python文件以及xml 文件。在$\backslash$functions$\backslash *.xml$ 中定义了相关函数的接口(如ohutils.xml)，还有枚举变量(如enumations.xml)等。只有把函数接口或者枚举变量的定义添加到这些xml文件中，编译阿拉丁后才会自动生成EXCEL能够识别
    的函数。
\item \emph{ohxllib}主要是\emph{ObjectHandler} 对象相关的C++代码（如$\backslash$functions$\backslash *.cpp$）
\item \emph{qlgensrc} 与\emph{ohgensrc} 非常类似，主要用于生成\emph{Quantlib}对象的接口,这些对象用于量化金融相关的运算
\item \emph{Quantlib} 包含了核心的量化金融计算的C++代码
\item \emph{QuantlibObjects} 在\emph{Quantlib} 中修改或者添加的函数，要在此工程中进一步处理，方便函数能够在\emph{QuantlibXLStatic} 调用和进行最终处理
\item \emph{QuantlibXLStatic} 根据\emph{qlgensrc}中的xml文件自动生成了EXCEL 能够识别的函数接口。不需要手动修改。
\item \emph{xlsdk} 定义了C++与EXCEL的接口函数以及变量类型，不需要修改。
\end{itemize}


\subsubsection{EXCEL中的静态对象}
阿拉丁中在EXCEL中可以生成存储信息的静态对象，返回值为"objName$\#$001"的格式，其中"objName" 是自定义的对象名称，$\#$后的数字代表版本号。对象每被刷新一次，对应的版本号会更新一次。

生成的静态对象可以作为输入参数再次被其他函数直接调用，比如(\ref{MCExample})中提到的ProcessID和ParamsID都是生成的静态对象，随后可以作为输入参数被蒙特卡洛定价模型函数调用。

使用静态对象可以增加代码的可用性，比如一个函数可以把输入参数分成几个对象，每个对象背后的代码可以被修改，而不会影响到其他对象的代码。另外在EXCEL 中，对象的使用也极大增强了可读性。



\subsubsection{期权的蒙特卡洛定价方法}
\label{MCExample}


在阿拉丁中使用MC方法分为两步：第一步是生成定价引擎(pricing engine)的对象ID\footnote{在阿拉丁工程中的\emph{pricingengines}文件夹已经包含了绝大部分期权的MC定价方法}，里面包含了定价模型所需的参数，对于不同的定价引擎，这些参数基本都是统一不变的，比如
\begin{itemize}
\item \emph{EngineID}  定价模型的名称。阿拉丁中对于不同的大类产品都对应有不同的定价模型。此变量是一个字符串，比如"MCE", 代码会找到此字符串对应的模型
\item \emph{ProcessID} 标的物价格的随机过程(比如BS过程)的对象ID
\item \emph{ParamsID} MC模型相关参数的对象ID，包含信息如下
\begin{enumerate}
\item \emph{timeStep} 指每条模拟路径上离散化成多少步数
\item \emph{brownianBridge} bool型，是指是否使用布朗桥方法
\item \emph{antitheticVariate} bool 型，是指是否使用antithetic方法来提高MC的模拟过程中的收敛速度
\item \emph{samples} 指至少需要模拟多少条路径
\item \emph{absoluteTolerance} MC收敛的阈值：MC收敛的误差低于这个阈值时会停止计算。此处误差的计算方法为$\frac{\s}{\sqrt{N}}$，其中$\s$表示样本的标准差，$N$表示样本数（即路径数）
\item \emph{maxSamples} 指MC最多模拟多少条路径。在函数\emph{value}中会根据收敛误差阈值估算出需要模拟多少条路径，当次数目大于\emph{maxSamples} 时，程序会终止
\item \emph{seed}设置随机数生成器的种子
\end{enumerate}
\end{itemize}

第二步是调用计算价值的函数,一般是\emph{qlInstrumentNPV}。此类函数会促发定价引擎ID 中的计算函数\emph{pathPricer},此函数返回一个用于路径定价类\footnote{比如\emph{EuropeanPathPricer}}的指针。
这个类中的重载函数\emph{operator()}是具体计算给定路径上的期权价值的函数。不同的期权应该有不同的定价引擎以及不同的路径定价类，但是定价引擎ID中的\emph{pathPricer}函数是多态的。相关函数为\footnote{可见$\backslash$QuantLib$\backslash$ql$\backslash$pricingengines$\backslash$vanilla$\backslash$mceuropeanengine.hpp 为例}

\begin{itemize}
\item \emph{Path}是一个记录路径信息的基类，包括路径的各个离散化的时刻，初始时刻标的物价格(\emph{front}函数)，到期时刻标的物价格(\emph{back}函数)
\end{itemize}



\paragraph{欧式期权定价结构示意图}
本段以欧式期权定价为例演示(\ref{MCExample})提到的模型代码结构。

\begin{figure}
\centering
\scalebox{0.75}{\includegraphics{Workflow-alMCPricingEngine2.jpg}}
\caption{欧式期权定价引擎结构示意图}
\label{EuropeanOptionPricingStructure}
\end{figure}

\begin{figure}
\centering
\scalebox{0.75}{\includegraphics{Workflow-qlInstrumentNPV.jpg}}
\caption{NPV函数计算结构示意图}
\label{EuropeanOptionPricingStructure}
\end{figure}

\newpage




\paragraph{障碍期权}
障碍期权的定价方法在$\backslash$Quantlib$\backslash$pricingengines$\backslash$barriers$\backslash$*.cpp 中
\begin{itemize}
\item  派生类\emph{BarrierPathPricer}的函数\emph{operator()}定义了DownIn,UpIn,DownOut,UpOut四种单边障碍期权的每条路径如何计算期权的价值的方法
\end{itemize}


\section{C\#量化分析库}
\emph{物华天宝}是嘉合量化投资部自行开发的基于C\#/C++的量化分析库。与\emph{阿拉丁}不同的是，\emph{物华天宝}主要是用于涉及大量数据处理的分析工作（如行业的超额收益跟踪等），以及交易策略的日常监控，并且具有可视化功能（可自动生成分析图片）。

\subsection{行业跟踪}
行业跟踪主要有以下几个主要指标类，即行业动量反转指标，行业交投指标，行业估值指标，行业基本面指标以及分析师预期指标。

行业动量反转指标为申万28个行业指数相对于任意主要市场指数的1,5,10,60,120,250日超额收益情况，数据源自万得，包括
\begin{itemize}
\item 行业指数超额收益
\item 行业指数超额收益分位数，即当天计算出的超额收益情况与历史数据计算出的日频的超额收益数据序列相比处于哪个分位数。历史数据为2005 年1月开始至计算日的前一交易日
\end{itemize}

行业交投指标，数据源自万得，包括
\begin{itemize}
\item 行业周频的平均日成交金额,单位为亿。计算方法为每周总成交金额除以交易日的数目。
\item 行业周频的平均日成交量,单位为亿。计算方法为每周总成交量除以交易日的数目。
\item 行业周频的平均日成交金额和成交量与历史均值的偏移百分比。历史均值为周频的平均日成交金额，再根据其每周交易日天数进行加权平均。
\item 行业周频的周成交量比，即交易日最近的上周成交量除以包含该周在内的最近四周平均成交量之比。
\item 行业周频的平均日换手率和日换手率与历史均值的偏移百分比。历史均值为周频的平均日成交金额，再根据其每周交易日天数进行加权平均。
\end{itemize}



行业基本面指标，数据来自朝阳永续，由于没有直接的行业数据，故返回的是行业成分股数据的中位数，包括
\begin{itemize}
\item 行业主营收入同比增长率
\item 行业净利润同比增长率
\item 行业毛利率
\item 行业净利率
\item 行业ROE
\end{itemize}

分析师对行业的预期指标，数据来自朝阳永续，包括
\begin{itemize}
\item 行业一致预期PE,以及相对全市场的PE(行业PE 除以市场PE)
\item 行业一致预期PB,以及相对全市场的PB(行业PB 除以市场PB)
\item 行业一致预期ROE
\item 行业一致预期净利同
\item 年频的行业组合预期变动指数
\item 年频的行业2年复合增长率
\end{itemize}

\section{MATLAB量化分析库}
\emph{巨石STONE}是嘉合量化投资部自行开发的基于MATLAB的量化分析库。与\emph{阿拉丁}不同的是，\emph{巨石}主要是用于涉及大量数据处理的分析工作，并且具有可视化功能（可自动生成分析图片）
，目前主要分析功能是每日超额收益跟踪以及分析师行业一致预期的追踪。


\subsection{超额收益跟踪}
\subsubsection{模块功能}
超额收益跟踪分为三类，基准标的均为沪深300 指数。

该模块分析了不同指数、行业以及风格相对于沪深300 指数的超额收益率。可以进行1、3、10、20、30、60、120、\\
150、250和500日的超额收益分析。
\begin{itemize}
\item 指数跟踪。跟踪了26个常用指数。包括上证、中证等多个指数。
\item 行业跟踪。跟踪了申万28个行业指数，包括农林牧渔、采掘、化工等。
\item 风格跟踪。跟踪了申万17个风格指数，包括大盘指数、小盘指数、市盈率指数以及市净率指数等。
\end{itemize}

\subsection{分析师行业一致预期跟踪}
分析师行业一致预期跟踪，直接调用\emph{朝阳永续}数据库中对各行业的一致预期。包括申万28个行业的最新PEI\footnote{朝阳永续自制的预期净利润指数}、1 （或者3,6）个月前PEI，最新一致预期净利增长\footnote{百分比}，1 （或者3,6）个月前一致预期净利增长，PEI环比
变化，一致预期净利润增长变化。pei.m函数为相对应的提取朝阳永续数据的子函数。

在可视化窗口中，可以提供一键导出excel表格，导出超额收益分位数柱状图的功能。


\subsection{模块代码概述}
\subsubsection{超额收益计算}
函数premium.m为三类超额收益跟踪函数所共同使用的核心函数，功能为从Wind中提取数据，并计算相对应的超额收益以及超额收益分位数。
\begin{itemize}
\item 函数输入。函数输入7个变量，a为指数（风格、行业）代码，b1到b5分别为所选择的b日超额收益，d为计算的基准日期。\footnote{注意wind数据库所识别的代码格式，以及日期格式}
\item 函数输出。函数输出为向量，为：（b1 日超额收益，b1日超额收益分位数，...，b5日超额收益，b5日超额收益分位数）
\item 函数内容。函数第四列为使用wind提取数据，'000300.SH'代表此函数所计算的超额收益基准为沪深300指数，可以进行相应修改。'2005-01-07'为所提取的数据自2005年1 月7日起。

    在此需要说明的是，如果有指数
的编撰日期在2005年1月7日之后，Wind数据库将该指数不存在的这一段日期的值返回为NaN，通过函数下部分的内容，会删除没有返回数值的日期，将该指数的起始日期调整为最开始返回值的日期，当然
其他指数起始日期保持不变。

在计算分位数时，采用了如下方法：今日超额收益分位数=小于今日超额收益的天数/总天数。
\end{itemize}


\subsubsection{可视化界面}
双击\textbf{integration.m}文件即可启动可视化界面。

在对每一种超额收益的可视化实现中，采用了同样的计算函数premium。不同的超额收益可视化视窗是通过Matlab GUIDE 模块实现的。.fig文件为可视化窗口的绘制文件。通过输入guide命令可以打开GUIDE界面。在本分析库中主要使用了以下几个模块：
\begin{itemize}
\item edit text, static text为文字显示界面。edit text文本框可以进行编辑，所输入的内容保存在句柄handles.edit中，可以通过函数day=get(handles.editday,'String') 在不同的响应函数中提取。
\item popupmenu为下拉文本框。句柄get(handles.popupmenu,'Value')可以获得所选择了下拉菜单的第几列菜单。
\item editbox可以显示所输入的矩阵。
\end{itemize}




\section{分级基金}
\fontsize{9}{11}
\selectfont
[http://www.jisilu.cn/question/15651]

[http://mt.sohu.com/20150504/n412314102.shtml]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

\subsection{概述}
\emph{分级基金}是指在一个投资组合下，通过对基金收益或净资产的分解，形成两级（或多级）风险收益表现有一定差异化基金份额的基金品种。它的主要特点是将基金产品分为两类或多类份额，
并分别给予不同的收益分配。

分级基金各个子基金的净值与份额占比的乘积之和等于母基金的净值。例如拆分成两类份额的母基金净值$=$A 类子基净值 $\fois$ A份额占比$+$ B类子基净值 $\fois$ B份额占比。如果母基金不进行拆分，其本身是一个普通的基金。

\subsection{分级基金的折算}
分级基金的折算是针对分级基金的三类份额（母基金，A类与B类份额，即优先级与普通级）而设定的条款，其目的是为了保护A类份额持有人，兑现部分A类收益，以及防止B 类归零的发生。
基金折算，与基金的拆分有点相似，但复杂性远超后者，主要有以下三种折算方式
\begin{itemize}
\item \emph{定折}
    即定期折算，是指在每一个计息周期结束后，将A份额的约定收益折算为母基，投资者可通过赎回母基实现收益。定折多数发生在每年的年底和年初。要注意的是，折算基准日当天A 份额和B 份额是
    正常交易的，但是母基当天不能申购和赎回，所以，当天买入A份额和B份额是无法合并做折价套利的
\item \emph{上折}
    也就是向上折算，是不定期折算的一种形式，按照分级基金的发行文件，当分级基金母基的净值上涨至某个价格（比如1.5 元），分级基金将进行上折，上折是由于母基对应的指数大幅上涨造成的，此时B 份额大涨之后杠杆降低，上折后A 份额和B 份额的净值均回归为初始净值1，超过1 的部分将以母基的形式发放给A份额和B份额的持有人，因此，发生上折时，B份额和A份额的持有人都将获得母基份额。牛市中出现上折的情况比较多。
上折的折算基准日A和B份额正常交易，但是母基无法申购和赎回，大家在场内买入的A 份额和B份额是不能合并的。

\item\emph{下折}
    与上折正好相反，下折是当B份额的净值下跌到某个价格时（比如0.25元），为了保护A份额持有人利益，基金公司按照合同约定对分级基金进行向下折算，折算完成后，A份额和B份额的净值重新
回归初始净值1，A份额持有人将获得母基份额，B 份额持有人的份额将按照一定比例缩减。
下折一般都发生在熊市当中，下折之前基金公司都会发布提示公告。当发生下折时，折算基准日A 份额和B 份额是10：30开始交易，当日虽然可以同时买入A 份额和B份额，但由于当日母基暂停申赎，
因此，即使买入A份额和B份额，当日是无法合并的


\end{itemize}

\subsection{分级基金的相关指标}
\emph{秦皇岛}中的分级基金Viewer模板可以监控任意分级基金的市场指标。用$V,V_{A},V_{B}$表示当前母基金,A份额和B 份额的净值，$P_{A},P_{B}$表示A份额和B份额的交易价格，$\a,1-\a$ 表示A 份额和B 份额的拆分占比。假设B份额净值下降至$V_{B,l}$时或者母基金净值上升至$V_{u}$，其净值归一。

\begin{itemize}
\item   \emph{预估下折母基金仍需跌幅} $d=1-\left( \frac{V_{B,l}(1-\a)+V_{A}\a}{V} \right)$

\fontsize{9}{11}
\selectfont
[
此处假设A份额的净值保持不变，在下跌过程中，母基金的净值等于A以及B份额净值之和，由此可得
\begin{eqnarray*}
V(1-d) =V_{B,l}(1-\a)+V_{A}\a
\end{eqnarray*}
整理即得到关于$d$的表达式。

]
\fontsize{10}{11}
\selectfont

\item   \emph{价格杠杆倍数} $l=\frac{V}{P_{B}\a}$
\item \emph{预估上折母基金仍需涨幅} $u=\frac{V_{u}}{V}-1$
\item \emph{A份额隐含收益率} $R_{A,Implied}=\frac{R_{A,agreed}}{1+P_{A}-V_{A}}$。$R_{A,agreed}$ 是A 份额的约定收益，考虑溢价（或者折价后）才是A份额的真正收益率。
\item \emph{A份额下折理论收益} $R_{A,discount} = (1-V_{B,l})\left(1-\frac{R_{A,agreed}}{R_{A,Implied}}\right)$

[
下折后，每份A份额变成$V_{A}-V_{B,l}$份净值为1 的母基金和$V_{B,l}$份净值为$1-V_{A}+P_{A}$ 的新A份额，所得收益为下折前后A 份额的单位价格\footnote{假设下折完成时刻份额无折溢价，即份额的价格等于净值}之差，即
\begin{eqnarray*}
\Delta P_{A} &=& V_{A}-V_{B,l} + V_{B,l}\left( 1-V_{A}+P_{A}\right) \\
            &=& \left( 1- V_{B,l}\right)\left( V_{A}-P_{A}\right)\\
            &=&(1-V_{B,l})\left(1-\frac{R_{A,agreed}}{R_{A,Implied}}\right)
\end{eqnarray*}
   上式第三行的依据是：根据$R_{A,Implied}$ 定义得到$V_{A}-P_{A} = 1-\frac{R_{A,agreed}}{R_{A,Implied}}$，代入公式第二行即可得到第三行的结果
]


\end{itemize}

\section{附录}
\subsection{天软函数}
\textbf{GetBkWeightByDate} 返回沪深300 指数的当日权重。 但是这一权重只有月初才是交易所官方数据；月中时返回的权重为天软内部自己逆向测算所得，并非交易所数据。

\textbf{PoolScoring} 在给定的股票池中，对所有股票进行打分
\begin{enumerate}
\item 首先去除掉未上市，上市不满半年，ST，每股净资产小于1 的股票
\end{enumerate}


\textbf{report} 返回某个报告期的某项财务指标或其他信息的值. 第一个输入参数为信息类别代码(具体可查询数据字典，比如46080代表营业总收入)，第二个输入参数报告期（比如20150331）


\subsection{证明：期权价格函数是行权价格的凸函数}
\begin{proof}

以$C(K,T)$表示行权价$K$，到期日$T$的欧式看涨期权的价值，$S_{t}$表示在时刻$t$ 标的$S$ 的价格。在风险中性测度下
\begin{eqnarray}
C(K,T) &=&  e^{-r(T-t)}\E \left[ \max\left(S_{T}-K,0\right) | S_{t}\right]   \nonumber \\
&=& e^{-r(T-t)}\int_{o}^{\infty}\left[ \max\left(S_{T}-K,0\right) | S_{t}\right]q(S_{T}|S_{t})dS_{T}
\label{OptionDensity}
\end{eqnarray}

公式(\ref{OptionDensity})中的$q(S_{T}|S_{t})$ 表示期权到期收益的概率（条件）密度函数。对公式(\ref{OptionDensity}) 两边求二次偏导，得到
\begin{eqnarray}
\frac{\partial^{2} C(K,T)}{\partial K^{2}} =e^{-r(T-t)}q(S_{T}|S_{t})
\label{partialDensity}
\end{eqnarray}

由于概率密度函数$q(S_{T}|S_{t}) \ge 0$, 同时根据公式(\ref{partialDensity})可以得到$\frac{\partial^{2} C(K,T)}{\partial K^{2}} \ge 0$，即期权价格函数$C(K,T)$是行权价$K$的凸函数
\end{proof}



\subsection{Delta对冲的相关定理}
\label{DeltaHedge}


\subsubsection{证明：定理(\ref{VolThem1})\emph{实际波动率对冲的最终收益}}

\begin{proof}
首先通过购买价值$V_{t}^i$的期权，并且卖出$\Delta ^{a}$ 标的物来构建一个\emph{自融资}的投资组合，这个投资组合的具体构成见表(\ref{volthem1_table1})

\begin{table}
\centering
\begin{tabular}{|rr|}
\hline Component&Value\\\hline
\hline Option&$V_{t}^{i}$\\
 Stock& $-\Delta ^{a}S_{t}$\\
 Cash&$-V_{t}^{i}+\Delta
^{a}S_{t}$\\
\hline
\end{tabular}\caption{当日资产组合构成和价值}
\label{volthem1_table1}
\end{table}

经过$dt$时间，资产组合各成分变化可见表(\ref{volthem1_table2})。期权和标的物都会对应的变化，另外现金账户累计了利息，同时付出股息。

\begin{center}
\begin{table}
\centering
\begin{tabular}{|rr|}
 \hline Component&Value\\\hline
\hline Option&$V_{t}^{i}+dV_{t}^{i}$\\
 Stock& $-\Delta ^{a}S_{t}-\Delta ^{a}dS_{t}$\\
 Cash&$(-V_{t}^{i}\Delta
^{a}S_{t})(1+rdt)-q\Delta ^{a}S_{t}dt$\\\hline
\end{tabular}\caption{$dt$时间后资产组合构成和价值}
\label{volthem1_table2}
\end{table}
\end{center}

所以在$dt$时间内实现的逐日盯市的收益(mark to market profit)为
\begin{eqnarray}
dV_{t}^{i}-\Delta ^{a}dS_{t}-r(V_{t}^{i}-\Delta ^{a}S_{t})dt-q\Delta
^{a}S_{t}dt  \label{profit}
\end{eqnarray}

根据定义，实际波动率能“正确”定价当前的期权。自融资组合的期权和对冲Delta如果都是以实际波动率计算，那么自融资组合将是一个无风险组合，不能获得超额收益， 所以可得
\begin{eqnarray}
dV_{t}^{a}-\Delta ^{a}dS_{t}-r(V_{t}^{a}-\Delta ^{a}S_{t})dt-q\Delta
^{a}S_{t}dt=0  \label{Eq price}
\end{eqnarray}

从公式(\ref{Eq price})可得到
\begin{eqnarray*}
\Delta ^{a}dS_{t}-r\Delta ^{a}dS_{t}-q\Delta
^{a}S_{t}dt=dV_{t}^{a}-rV_{t}^{a}dt
\end{eqnarray*}

代入公式(\ref{profit})
\begin{eqnarray}
\begin{split}
&dV_{t}^{i}-dV_{t}^{a}-r(V_{t}^{i}-V_{t}^{a})dt\\&=e^{rt}(e^{-rt}d(V_{t}^{i}-V_{t}^{a})-re^{-rt}(V_{t}^{i}-V_{t}^{a})dt)
\\&
=e^{rt}d(e^{-rt}(V_{t}^{i}-V_{t}^{a}))
\end{split}
\label{Eq price_dt}
\end{eqnarray}

公式(\ref{Eq price_dt})对应 $t$到$t+dt$时间的盈利. 此盈利的现值为
\begin{eqnarray}
e^{-r(t-t_{0})}e^{rt}d(e^{-rt}(V_{t}^{i}-V_{t}^{a}))=e^{-rt_{0}}d(e^{-rt}(V_{t}^{i}-V_{t}^{a}))
\label{PV1}
\end{eqnarray}

在到期日时$V_{T}^{i}=V_{T}^{a}$(因为到日期payoff 相同). 所以从 $%
t_{0}$ 到$T$总收益的现值为
\begin{eqnarray}
\begin{split}
&e^{rt}
\int_{t_{0}}^{T}d(e^{-rt}(V_{t}^{i}-V_{t}^{a}))\\&=e^{r(t_{0}-T)}(V_{T}^{i}-V_{T}^{a})-(V_{t_{0}}^{i}-V_{t_{0}}^{a})
\\&
=V_{t_{0}}^{a}-V_{t_{0}}^{i}  \label{PV2}
\end{split}%
\end{eqnarray}

\end{proof}

\subsubsection{证明：定理(\ref{VolThem2})\emph{实际波动率和隐含波动率对冲的逐日盯市收益}}
\paragraph{实际波动率的逐日盯市收益}
\begin{proof}
根据Ito引理可得
\begin{eqnarray*}
dV^{i}=\Theta ^{i}dt+\Delta ^{i}dS_{t}+\frac{1}{2}\sigma ^{2}S_{t}^{2}\Gamma
^{i}dt
\end{eqnarray*}

所以公式(\ref{profit})可以改写成
\begin{eqnarray}
\begin{split}
&\Theta ^{i}dt+\Delta ^{i}dS_{t}+\frac{1}{2}\sigma
^{2}S_{t}^{2}\Gamma ^{i}dt-\Delta ^{a}dS_{t}-r(V_{t}^{i}-\Delta
^{a}S_{t})dt-q\Delta ^{a}S_{t}dt \\&=\Theta ^{i}dt+\mu (\Delta
^{i}-\Delta ^{a})S_{t}dt+\frac{1}{2}\sigma ^{2}S_{t}^{2}\Gamma
^{i}dt- \sigma (\Delta ^{i}-\Delta\newline ^{a})S_{t}dW_{t}-\\& \ \
\ \ r(V_{t}^{i}-\Delta ^{a}S_{t})dt-q\Delta
^{a}S_{t}dt\\
&=(\Theta ^{i}+(r-q)\Delta ^{i}S_{t}+\frac{1}{2}\widetilde{\sigma }%
^{2}S_{t}^{2}\Gamma ^{i}dt-rV_{t}^{i})dt+\mu (\Delta ^{i}-\Delta
^{a})S_{t}dt+\\& \ \ \ \ \frac{1}{2}(\sigma ^{2}- \widetilde{\sigma
}^{2})S_{t}^{2}\Gamma ^{i}dt+\sigma (\Delta ^{i}-\Delta
^{a})S_{t}dW_{t}-(r-q)(\Delta ^{i}-\Delta ^{a})S_{t}dt
\end{split}%
\label{profit_1}
\end{eqnarray}

同时$V_{t}^{i}$ 满足Black-Scholes PDE
\begin{eqnarray}
\Theta ^{i}+(r-q)\Delta ^{i}S_{t}+\frac{1}{2}\widetilde{\sigma }%
^{2}S_{t}^{2}\Gamma ^{i}dt-rV_{t}^{i}=0  \label{BS}
\end{eqnarray}

此处用$\pi _{t}^{a}$ 表示用实际波动率对冲的策略收益。 把公式(\ref{BS})代入(\ref{profit_1}),可得到策略的瞬时收益为
\begin{eqnarray*}
d\pi _{t}^{a}=\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma } ^{2})S_{t}^{2}%
\Gamma ^{i}dt+(\Delta ^{i}-\Delta ^{a})((\mu -r+q)S_{t}dt+\sigma S_{t}dW_{t})
\end{eqnarray*}
\end{proof}



\paragraph{隐含波动率的逐日盯市收益}

\begin{proof}
如果用隐含波动率$\widetilde{\sigma }$对冲, 对冲策略的瞬时收益 $d\pi _{t}^{i}$
\begin{eqnarray}
\begin{split}
dV_{t}^{i}-\Delta ^{i}dS_{t}-r(V_{t}^{i}-\Delta ^{i}S_{t})dt-q\Delta
^{i}S_{t}dt \\
=\Theta ^{i}dt+\frac{1}{2}\sigma ^{2}S^{2}\Gamma ^{i}dt-r(V_{t}^{i}-\Delta
^{i}S_{t})dt-q\Delta ^{a}S_{t}dt  \label{PV21}
\end{split}%
\end{eqnarray}

根据公式(\ref{BS})代入(\ref{PV21})，可得
\begin{eqnarray*}
d\pi _{t}^{i}=\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma }^{2})S_{t}^{2}%
\Gamma ^{i}dt  \label{PV22}
\end{eqnarray*}

所以该策略总收益的现值为
\begin{eqnarray*}
\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma }^{2})
\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{i}dt  \label{PV23}
\end{eqnarray*}

\end{proof}

\subsubsection{证明：定理(\ref{VolThem3})\emph{对冲收益的普遍性结果}}

\begin{proof}
如果对冲策略的Delta值使用
$\sigma _{h}$来计算，那么逐日盯市的瞬时收益$d\pi _{t}^{h}$ 为
\begin{eqnarray}
\begin{split}
&dV_{t}^{i}-\Delta ^{h}dS_{t}-r(V_{t}^{i}-\Delta
^{h}S_{t})dt-q\Delta ^{h}S_{t}dt
\\&=(dV_{t}^{i}-dV_{t}^{h}-r(V_{t}^{i}-V_{t}^{h})dt)+ (dV_{t}^{h}-
\Delta ^{h}dS_{t}-r(V_{t}^{h}-\Delta ^{h}S_{t})dt-q\Delta
^{h}S_{t}dt)
\end{split}
\label{App_Carr_1}
\end{eqnarray}

公式(\ref{App_Carr_1})说明收益可以分为两部分。

从公式(\ref{PV1})和(\ref{PV2})可知第一项的现值为$V_{t_{0}}^{h}-V_{t_{0}}^{i}$。

从公式(\ref{PV21}), (\ref%
{PV22})和(\ref{PV23}), 可以第二项的现值为
$\ \frac{1}{2}(\sigma ^{2}-\sigma
_{h}^{2})\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{h}dt$.

所以总收益的现值为
\begin{eqnarray}
V_{t_{0}}^{h}-V_{t_{0}}^{i}+\frac{1}{2}(\sigma ^{2}-\sigma
_{h}^{2})\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{h}dt
\label{App_Carr_2}
\end{eqnarray}

下面研究总收益的有界性。

首先其收益的下界为 $V_{t_{0}}^{h}-V_{t_{0}}^{i}$。为了找寻上界，只需要最大化公式(\ref{App_Carr_2}) 积分中的 $%
S_{t}^{2}\Gamma ^{h}$ 。

定义
\begin{eqnarray*}
f(S_{t})=S_{t}^{2}\Gamma ^{h}
\end{eqnarray*}

代入$\Gamma ^{h}$的定义公式, 可得到
\begin{eqnarray*}
f(S_{t})=S_{t}\frac{1}{\sigma _{h}\sqrt{T-t}} N^{\prime }(d_{1})\,=S_{t}%
\frac{1}{\sigma _{h}\sqrt{T-t}}\frac{1}{\sqrt{2\pi }}\exp (-\frac{1}{2}%
d_{1}^{2})
\end{eqnarray*}
其中
\begin{center}
$d_{1}=\frac{\ln (\frac{S_{t}}{K})+(r+\frac{\sigma _{h}^{2}}{2})(T-t)}{%
\sigma _{h}\sqrt{T-t}}$
\end{center}

令$f(S_{t})$ 一阶导数为零，可得
\begin{eqnarray*}
%\begin{split}
 0=\frac{1}{\sigma
_{h}\sqrt{T-t}}\frac{1}{\sqrt{2\pi }}\exp (-\frac{1}{2} d_{1}^{2})+
S_{t}\frac{1}{\sigma _{h}\sqrt{T-t}}\frac{1}{\sqrt{2\pi }}\exp (-
\frac{1}{2}d_{1}^{2})\times (-d_{1})
\end{eqnarray*}
等价于
\begin{eqnarray}
0=\frac{1}{\sigma _{h}\sqrt{T-t}}\frac{1}{\sqrt{2\pi }}\exp
(-\frac{1}{2} d_{1}^{2})(1-\frac{d_{1}}{\sigma _{h}\sqrt{T-t}})
%\end{split}
\label{app_carr_3}
\end{eqnarray}

可知公式(\ref{app_carr_3})解为$d_{1}=\sigma _{h}\sqrt{T-t}$，所以最优解$S_{t}$ 为
\begin{eqnarray*}
S_{t}=K\exp (-(r-q-\frac{\sigma _{h}^{2}}{2}%
)(T-t))
\end{eqnarray*}

当$S_{t}$ 为最优解时, 积分项等价于
\begin{eqnarray}
\frac{1}{2}(\sigma ^{2}-\sigma
_{h}^{2})\int_{t_{0}}^{T}e^{-r(t-t_{0})}S_{t}^{2}\Gamma ^{h}dt=\frac{%
(\sigma ^{2}-\sigma _{h}^{2})K\ }{2\sigma _{h}\sqrt{2\pi }}%
e^{-r(T-t_{0})}\int_{t_{0}}^{T}e^{q(T-t)}\frac{1}{\sqrt{T-t}}dt
\label{app_carr_4}
\end{eqnarray}

根据公式(\ref{App_Carr_2})和(\ref{app_carr_4})，所以总收益的上界为
\begin{eqnarray*}
V_{t_{0}}^{h}-V_{t_{0}}^{i}+\frac{
K(\sigma ^{2}-\sigma _{h}^{2})\ }{\sigma _{h}\sqrt{2\pi }}%
e^{-r(T-t_{0})}\int_{0}^{\sqrt{T-t_{0}}}e^{qu^{2}}du
\end{eqnarray*}

在特殊情况$q=0$时, 总收益的上界为显式解
\begin{eqnarray*}
V_{t_{0}}^{h}-V_{t_{0}}^{i}
+\frac{K(\sigma ^{2}-\sigma _{h}^{2})\ }{\sigma _{h}\sqrt{2\pi }}%
e^{-r(T-t_{0})}\sqrt{T-t_{0}}
\end{eqnarray*}
\end{proof}


\subsubsection{证明：定理(\ref{VolThem3})\emph{对冲收益的普遍性结果}}

\begin{proof}

$F(S,t)$ 满足
\begin{eqnarray}
\frac{\partial F}{\partial t}+\frac{1}{2}\sigma
^{2}S^{2}\frac{\partial ^{2}F}{\partial s^{2}}+\mu S\frac{\partial
F}{\partial S}+\frac{1}{2}(\sigma ^{2}-\widetilde{\sigma
}^{2})e^{-r(t-t_{0})}S\Gamma ^{i}=0
\label{App_EP_1}
\end{eqnarray}
边界条件为$F(S,T) = 0,F(S,0) = 0$.

令$F(S,t)=w(x,\tau )$ 其中
\begin{center}
$x=\ln (S/K)+\frac{2}{\sigma ^{2}}(\mu -\frac{1}{2}\sigma ^{2})\tau
$ and $\tau =\frac{\sigma ^{2}}{2}(T-t)$
\end{center}

所以公式(\ref{App_EP_1})等价于
\begin{eqnarray}
\frac{\partial w}{\partial \tau }=\frac{\partial ^{2}w}{\partial
\tau ^{2}}+\frac{K(\sigma ^{2}-\widetilde{\sigma }%
^{2})e^{-r(t-t_{0})}e^{-s_{2}^{2}/2}}{\sigma \widetilde{\sigma
}\sqrt{2\pi }}
\label{App_EP_2}
\end{eqnarray}

其中
\begin{center}
$d_{2}=\frac{\sigma }{\widetilde{\sigma }}\frac{x-\frac{2}{\sigma ^{2}}%
(\mu -\frac{1}{2}\sigma ^{2})\tau +\frac{2}{\sigma ^{2}}(r-q-\frac{1}{2}%
\widetilde{\sigma }^{2})\tau }{\sqrt{2\tau }}$
\end{center}

此类方程的解是已知的
\begin{eqnarray*}
\frac{\partial w}{\partial \tau }=\frac{\partial ^{2}w}{\partial
\tau ^{2}}+f(x,\tau )
\end{eqnarray*}

所以公式(\ref{App_EP_2})的解为
\begin{eqnarray}
\begin{split}
&\frac{1}{2\pi }\frac{K(\sigma ^{2}-\widetilde{\sigma }^{2})e^{-r(t-t_{0})}}{%
\sigma \widetilde{\sigma }}\int_{-\infty }^{\infty }\int_{0}^{\tau }\frac{1}{%
\sqrt{\tau ^{^{\prime }}}}\frac{1}{\sqrt{\tau -\tau ^{^{\prime }}}}\\&
\exp (-%
\frac{(x-x^{^{\prime }})^{2}}{4(\tau -\tau ^{^{\prime }})}-\frac{\sigma ^{2}%
}{4\widetilde{\sigma }\tau ^{^{\prime }}}(x^{^{\prime }}-\frac{2}{\sigma ^{2}%
}(\mu -\frac{1}{2}\sigma ^{2})\tau ^{^{\prime }})+\frac{2}{\sigma ^{2}}(r-q-%
\frac{1}{2}\widetilde{\sigma }^{2})\tau ^{^{\prime }})^{2})d\tau
^{^{\prime }}dx^{^{\prime }}
\end{split}
\label{ep2}
\end{eqnarray}


把公式(\ref{ep2})积分中的指数部分写成如下形式
\begin{eqnarray}
-a(x^{^{\prime }}+b)^{2}+c
\label{EP3}
\end{eqnarray}


公式(\ref{ep2})中的积分项可以简化成
\begin{eqnarray}
\begin{split}
&\int_{-\infty }^{\infty }\int_{0}^{\tau }\frac{1}{\sqrt{\tau ^{^{\prime }}}}%
\frac{1}{\sqrt{\tau -\tau ^{^{\prime }}}}\exp (-a(x^{^{\prime
}}+b)^{2}+c)d\tau ^{^{\prime }}dx^{^{\prime }}\\&
=\sqrt{\pi
}\int_{0}^{\tau }\frac{1}{\sqrt{\tau ^{^{\prime }}}}\frac{1}{\sqrt{%
\tau -\tau ^{^{\prime }}}}\frac{1}{\sqrt{a}}\exp (c)d\tau ^{^{\prime
}}
\end{split}
\label{EP2}
\end{eqnarray}

根据公式(\ref{ep2}) 和 (\ref{EP3}), 可以得到 $a$
和$c$ 的解, 代入公式(\ref{EP2})进而得到最终的解


\begin{eqnarray*}
\begin{split}
&F(S_{0},t_{0})=\frac{Ke^{-r(T-t_{0})}(\sigma ^{2}-\overset{\thicksim }{%
\sigma }^{2})}{2\sqrt{2\pi }}\int_{t_{0}}^{T}\frac{1}{\sigma ^{2}(s-t_{0})+%
\overset{\thicksim }{\sigma }^{2}(T-s)}\\&
\exp (-\frac{(\ln (S_{0}/K)+(\mu -%
\frac{1}{2}\sigma ^{2})(s-t_{0})+(r-q-\frac{1}{2}\sigma ^{2})(T-s))^{2}}{%
2(\sigma ^{2}(s-t_{0})+\overset{\thicksim }{\sigma }^{2}(T-s))})ds
\end{split}
\end{eqnarray*}

\end{proof}


\subsection{LPPL模型的拟合}
\label{App_LPPL_Calib}
根据公式(\ref{LPPLMain}),LPPL模型有7个参数需要估计，即$A,B,C, t_{c},m,\om, \phi$; 其中$t_{c},m,\om, \phi$ 为非线性参数，$A,B,C$ 为线性参数。为降低拟合参数的数量，同时为确保参数估计的稳定性，需要首先将线性参数用非线性参数估计值表达出来，从而只需要估计非线性参数即可。有诸多论文提出了拟合方法，此处引用了Sornette于2011 年提出的拟合改进方法。 \footnote{见A Stable and Robust Calibration Scheme of LPPL Model, \emph{Vladimir Filimonov, Didier Sornette}, 2011}


首先，
令$y_{t} = \ln p_{t}，C_{1} = C \cos \phi, C_{2} = C\sin\phi , f_{t} = \left(t_{c} - t \right)^m,g_{t} = \left(t_{c} - t \right)^m\cos\left[ \om \ln\left(t_{c} - t \right) \right]$,

$h_{t} = \left(t_{c} - t \right)^m\sin\left[ \om \ln\left(t_{c} - t \right) \right]$, 公式(\ref{LPPLMain}) 可改写成$y_{t} = A + Bf_{t} + C_{1}g_{t}+C_{2}h_{t}$

\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[
公式(\ref{LPPLMain})等价于
\begin{equation*}
\ln p_{t} = A + B\left(t_{c} - t \right)^m + C\left(t_{c} - t \right)^m \cos\left[ \om \ln\left(t_{c} - t \right)\right] \cos \phi + C\left(t_{c} - t \right)^m \sin\left[ \om \ln\left(t_{c} - t \right)\right]\sin \phi
\label{LPPLMain2}
\end{equation*}

令
\begin{equation*}
C_{1} = C \cos \phi, C_{2} = C\sin\phi
\end{equation*}

所以(\ref{LPPLMain})可改写为
\begin{equation}
\ln p_{t} = A + B\left(t_{c} - t \right)^m + C_{1}\left(t_{c} - t \right)^m \cos\left[ \om \ln\left(t_{c} - t \right)\right]  + C_{2}\left(t_{c} - t \right)^m \sin\left[ \om \ln\left(t_{c} - t \right)\right]
\label{LPPLMain3}
\end{equation}
]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

其次，假设区间内有$N$ 个$p_{t}$取值点, LPPL模型的拟合可以整理为最小化残差和的优化问题
\begin{equation*}
\min \limits_{A,B,C_{1},C_{2}, t_{c},m,\om} S\left( A,B,C, t_{c},m,\om \right)= \sum\limits_{i=1}^{N}\left( y_{t_{i}} -A - Bf_{t_{i}} - C_{1}g_{t_{i}}-C_{2}h_{t_{i}} \right)^2
\end{equation*}


再其次，将线性参数$A,B,C_{1},C_{2}$ 用非线性参数$t_{c},m,\om$表达出来, 那么优化问题可以转化为
\begin{equation*}
\min \limits_{A,B,C_{1},C_{2}, t_{c},m,\om} S\left( A,B,C, t_{c},m,\om \right) \equiv \min \limits_{t_{c},m,\om} S_{1}\left(  t_{c},m,\om  \right)
\end{equation*}
其中
\begin{equation}
S_{1}\left(  t_{c},m,\om\right) = \min \limits_{A,B,C_{1},C_{2}} S\left( A,B,C_{1},C_{2}, t_{c},m,\om \right)
\label{LPPLMain_Opt}
\end{equation}





那么优化问题(\ref{LPPLMain_Opt})等价于
\begin{equation}
\{ \Ah, \Bh, \widehat{C}_{1}, \widehat{C}_{2}  \} = \arg \min \limits_{A,B,\widehat{C}_{1}, \widehat{C}_{2} } S\left( A,B,C, t_{c},m,\om \right) = \arg \min \limits_{A,B,\widehat{C}_{1}, \widehat{C}_{2} }\sum\limits_{i=1}^{N}\left(   y_{t_{i}} -A - Bf_{t_{i}} - C_{1}g_{t_{i}}-C_{2}h_{t_{i}} \right)^2
\label{LPPLMain_Opt2}
\end{equation}

联立公式(\ref{LPPLMain_Opt2})的一阶条件可以得到关于$\{ \Ah, \Bh, \widehat{C}_{1}, \widehat{C}_{2} \}$ 的方程组，通过LU方法或者Cholesky方法可以得到$\{ \Ah, \Bh, \widehat{C}_{1}, \widehat{C}_{2} \}$ 的解。




\vspace{0.5cm}
\fontsize{9}{11}
\selectfont
[

$\{ \Ah, \Bh, \widehat{C}_{1}, \widehat{C}_{2} \}$应该满足公式(\ref{LPPLMain_Opt2})的一阶条件，联立方程之后可得到如下方程组

\begin{equation}
 \left(  \begin{array}{c} \sum\limits_{i=1}^{N}y_{t_{i}} \\ \sum\limits_{i=1}^{N}y_{t_{i}}f_{t_{i}}\\ \sum\limits_{i=1}^{N}y_{t_{i}}g_{t_{i}} \\\sum\limits_{i=1}^{N}y_{t_{i}}h_{t_{i}}   \end{array} \right) = \left(  \begin{array}{cccc}  N &\sum\limits_{i=1}^{N}f_{t_{i}} & \sum\limits_{i=1}^{N}g_{t_{i}}&  \sum\limits_{i=1}^{N}h_{t_{i}}  \\ \sum\limits_{i=1}^{N}f_{t_{i}} &\sum\limits_{i=1}^{N}f^2_{t_{i}} & \sum\limits_{i=1}^{N}f_{t_{i}}g_{t_{i}}&\sum\limits_{i=1}^{N}f_{t_{i}}h_{t_{i}} \\ \sum\limits_{i=1}^{N}g_{t_{i}} &\sum\limits_{i=1}^{N}f_{t_{i}} g_{t_{i}}& \sum\limits_{i=1}^{N}g^2_{t_{i}} &\sum\limits_{i=1}^{N}g_{t_{i}}h_{t_{i}} \\
  \sum\limits_{i=1}^{N}h_{t_{i}} &\sum\limits_{i=1}^{N}f_{t_{i}} h_{t_{i}}& \sum\limits_{i=1}^{N}g_{t_{i}}h_{t_{i}}& \sum\limits_{i=1}^{N}h^2_{t_{i}} \end{array}  \right)      \left(  \begin{array}{c} A \\B\\C_{1} \\C_{2}   \end{array} \right)
\label{LPPLMain5}
\end{equation}

%在公式(\ref{LPPLMain3})通过LU分解可以得到$ \left(  \begin{array}{c} A \\B\\C    \end{array} \right)$的解
令$b=\left(  \begin{array}{c} A \\B\\C_{1}\\C_{2}    \end{array} \right)$,$X=\left(  \begin{array}{cccc}
1 & f_{t_{1}} &g_{t_{1}}&h_{t_{1}} \\1 & f_{t_{2}} &g_{t_{2}} &h_{t_{2}} \\.&.&.\\.&.&.\\1 & f_{t_{N}} &g_{t_{N}}&h_{t_{N}}
\end{array}
 \right)$

 则公式(\ref{LPPLMain3})可以用矩阵形式表示为$X^{T}y = \left(X^{T}X  \right)b$, 所以可得到$b$的解
 \begin{equation}
\bh = \left(X^{T}X  \right)^{-1}X^{T}y
\label{LPPLMain6}
\end{equation}

]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}


所以优化问题的参数最终从七个变成了三个，即$\left( t_{c},m,\om \right)$。

参数估计\footnote{也可以用穷举法，效率较低}的方法分成两步
\begin{itemize}
\item 使用遍历方法或者禁忌搜索算法(Taboo)\footnote{算法见章节(\ref{App_Tabu})}找出10个局部解
\item 这10个局部解作为初始值，使用Levenberg-Marquardt非线性最优化算法来拟合曲线，使得$\sum\limits_{i=1}^{N}\left( y_{t{i}} - \hat{y_{t{i}}} \right)^2$ 取得最小值
\end{itemize}



\subsection{禁忌(Tabu)搜索算法}
\label{App_Tabu}

算法的伪代码如下
\begin{algorithm}[H]
\caption{禁忌搜索算法}

\begin{algorithmic}[1]
\Require
$s = s_{0}$, sBest$ =s$, tabuList = [ ]
\Ensure
\While {stoppingCondition() $==$ false}
\State    candidateList = [ ];
\State    bestCandidate = null;
    \For{sCandidate $\in $ sNeighborhood}
        \If { (not tabuList.contains(sCandidate)) $\&$ (fitness(sCandidate) $>$ fitness(bestCandidate)) }
        \State bestCandidate = sCandidate
        \EndIf
    \EndFor
    \State s = bestCandidate
    \If{fitness(bestCandidate) $>$ fitness(sBest)}
    \State sBest = bestCandidate
    \EndIf
\EndWhile\\
return  sBest;
\end{algorithmic}

\end{algorithm}


\subsection{信号处理理论的基本常识}
\subsubsection{时域与频域}
从我们出生，我们看到的世界都以时间贯穿，股票的走势、人的身高、汽车的轨迹都会随着时间发生改变。这种以时间作为参照来观察动态世界的方法我们称其为时域分析。频域是观察不到的域，横轴是频率，纵轴是该频率信号的幅度，也就是通常说的频谱图。频谱图描述了信号的频率结构及频率与该频率信号幅度的关系。时域是惟一客观存在的域，而频域是一个遵循特定规则的数学范畴。

正弦波是频域中唯一存在的波形，这是频域中最重要的规则，即正弦波是对频域的描述，因为时域中的任何波形都可用正弦波合成。使用正弦波作为频域中的函数形式有它特别的地方。若使用正弦波，则与互连线的电气效应相关的一些问题将变得更容易理解和解决。如果变换到频域并使用正弦波描述，有时会比仅仅在时域中能更快地得到答案。

动态信号从时间域变换到频率域主要通过傅立叶级数和傅立叶变换实现。周期信号靠傅立叶级数，非周期信号靠傅立叶变换。时域越宽，频域越短。

\subsubsection{信号的高频与低频}
高频与低频是指信号变化的频率。低频信号变化较为平缓，高频信号变化较为激烈，对于声音信号，一般将信号的高频部分理解为噪音， 低频部分为主要信息。对于图像信号，低频信号一般为背景，高频信号一般为边缘或者细节。


\subsubsection{复数域在信号处理的应用}
傅里叶变换（或者z变换）的作用是把信号从时域变换到频域上，方便对于频率进行过滤，然后再将其反向变换回来。比如说一个时域上的周期函数，波形是不规则的正弦波，通过傅里叶变换，可以过滤转换成平滑的正弦波。

\paragraph{傅里叶级数和傅里叶变换}
傅里叶级数的本质是将一个周期的信号分解成无限多分开的（离散的）正弦波，傅里叶级数在时域是一个周期且连续的函数，而在频域是一个非周期离散的函数。傅里叶变换则是将一个时域非周期的连续信号，转换为一个在频域非周期的连续信号（傅里叶变换实际上是对一个周期无限大的函数进行傅里叶变换）。

\subsection{Change of num\'eraire的相关定理}
\fontsize{9}{11}
\selectfont
[Interest Rate Model: Theory and Practice, \emph{Brigo and Mercurio}, 2002]
\fontsize{10}{11}
\selectfont
\vspace{0.5cm}

A \emph{num\'eraire} is any strictly positive $\mathcal{F}_{t}$ adapted process $N_{t}$ that can be taken as a unit of reference when pricing an asset or a claim.

\begin{theorem}
\label{thm_change_num}
Assume there exits a num\'eraire $N$ associated with a probability measure $Q^N$, equivalent to the initial measure $Q_{0}$ such that the price of any traded asset $X$ relative to $N$ is a martingale under $Q^N$, i.e.
\begin{eqnarray*}
\frac{X_{t}}{N_{t}}=E^N\left( \frac{X_{T}}{N_{T}}|\mathcal{F}_{t}\right)
\end{eqnarray*}

Let $U$ be an arbitrage num\'eraire. Then there exists a probability $Q^U$ equivalent to the initial measure $Q_{0}$ such that the price of any attainable claim $Y$ normalized by $U$ is a martingale under $Q^U$, i.e.
\begin{eqnarray*}
\frac{Y_{t}}{U_{t}}=E^U\left( \frac{Y_{T}}{U_{T}}|\mathcal{F}_{t}\right)
\end{eqnarray*}

Moreover the Radon-Nikodym derivative defining the measure $Q^U$ is given by
\begin{eqnarray}
\frac{dQ^U}{dQ^N}=\frac{U_{T}N_{0}}{U_{0}N_{T}}
\label{change_num}
\end{eqnarray}


\end{theorem}


\begin{proof}


(此处只简略证明公式(\ref{change_num}))
by definition of $Q^N$ we know that for any tradable asset $Z$
\begin{eqnarray}
\frac{Z_{0}}{N_{0}}=E^N\left( \frac{Z_{T}}{N_{T}}\right)=E^U\left( \frac{U_{0}}{N_{0}} \frac{Z_{T}}{U_{T}}\right)
\label{risk_neutral_price}
\end{eqnarray}

Also by definition of the Radon-Nikodym derivative
\begin{eqnarray*}
E^N\left( \frac{Z_{T}}{N_{T}}\right)=E^U\left( \frac{Z_{T}}{U_{T}} \frac{dQ^U}{dQ^N}\right)
\end{eqnarray*}

By comparing the above two equations we obtain equation(\ref{change_num}).

\end{proof}




There are basically two facts on the change of num\'eraire

\begin{proposition}
\label{prop_1}
The price of any asset divided by a reference positive non dividend-paying asset(called num\'eraire) is a martingale under the measure associated with that measure.
\end{proposition}

\fontsize{9}{10}
\selectfont
[此推论源自 \textbf{Theorem \ref{thm_change_num}}]
\fontsize{10}{10}
\selectfont

\begin{proposition}
\label{prop_2}
The risk neutral price is invariant by change of num\'eraire. Assume $B$ and $S$ are two num\'eraires, denote $H_{T}$ the payoff at maturity $T$ and $P_{t}$ the price at time $t\le T$, then
\begin{eqnarray*}
P_{t}=E^B\left(  B_{t} \frac{H_{T}}{B_{T}}\right)=E^S\left(  S_{t} \frac{H_{T}}{S_{T}}\right)
\end{eqnarray*}



\end{proposition}

\fontsize{9}{10}
\selectfont
[此推论其实就是重新组织了公式(\ref{risk_neutral_price})]
\fontsize{10}{10}
\selectfont
\vspace{0.5cm}

Num\'eraire的例子包括

\begin{itemize}
\item Money market account

\begin{eqnarray*}
N_{t} = \exp\left(\int_{0}^t r_{s}ds\right)
\end{eqnarray*}
where $r_{s}$ is the instantaneous short interest rate at time $s$.



\item Zero coupon bond(discount factor)

\begin{eqnarray*}
N_{t} = \DF(t,T) =\E\left(  e^{-\int_{t}^T r_{s}ds }|\mathcal{F}_{t} \right)
\end{eqnarray*}


\end{itemize}

The measure associated with money market account is called risk \emph{neutral measure} $Q^*$ and the one associated with zero coupon bond is called \emph{forward measure} $Q^T$.

From \textbf{Theorem \ref{thm_change_num}} it is straightforward to obtain
\begin{eqnarray}
\frac{dQ^T}{dQ^*}\bigg|_{t}=\frac{\DF(T,T)N_{t}}{\DF(t,T)N_{T}}= \frac{e^{-\int_{t}^T r_{s}ds}}{\DF(t,T)}
\label{change_num_2}
\end{eqnarray}


\fontsize{9}{10}
\selectfont
[If the short rate $r_{s}$ is deterministic then $e^{-\int_{t}^T r_{s}ds} = \DF(t,T)$ for all $t,T$. However if rates are stochastic, $e^{-\int_{t}^T r_{s}ds}$ is a random variable at $t$, instead the zero coupon bond price $\DF(t,T)$ is known at time $t$ ]
\fontsize{10}{10}
\selectfont


\end{document}
