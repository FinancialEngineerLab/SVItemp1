
%本回归测试检验Hurst策略程序是否更改，分别检验三个相关文件：Hurst_strategy_new,Hurst_Exponent_Log_whole和retraceratio

 %以下部分检验Hurst_Exponent_Log_whole文件
 w=windmatlab;
[w_wsd_data,w_wsd_codes,w_wsd_fields,w_wsd_times,w_wsd_errorid,w_wsd_reqid]=w.wsd('000001.SH','close','2014-01-05','2015-01-05','Fill=Previous');
if exist('w_wsd_codes')==0
    msgbox('Wind链接失败','警告','信息对话框图标');
    return;
end

in = w_wsd_data;
period1 = 120;
p = 40;

[Hurst,EH]=Hurst_Exponent_Log_whole (in, period1, p);
if (EH(2)-0.749870546543065)>0.01
    msgbox('Hurst_Exponent_Log_whole中计算EH的部分发生改动','警告','信息对话框图标');
    return;
end

Hurst_original = [0,0.661075876350615,0.662845703385286,0.653297614987520,0.660927977468382,0.648751216176235,0.648744674490859,0.663915471972234,0.655269451678340,0.637040886008448,0.649080513792029,0.651858810990949,0.658733681796456,0.644029530760587,0.652352002667669,0.663153192076972,0.696670829171240,0.691121172091776,0.683785136111072,0.687677996261303,0.690581530245706,0.690656326941770,0.694073141515975,0.700664187984227,0.705337578288522,0.703930395795733,0.677386938196574,0.676925762751299,0.683190435089598,0.685456561403431,0.693352190176102,0.700150695512789,0.694038956991002,0.681717355420992,0.684370315546487,0.693430590916339,0.688095635689984,0.693941429831454,0.692380714593511,0.699228854203099,0.698527237206975,0.690623893056261,0.691652217566193,0.709702406028869,0.713891138562320,0.709525290616643,0.713704863629789,0.704258437992258,0.688536299199704,0.686360560234189,0.693264914923068,0.671967764536182,0.688307743304650,0.684682646267029,0.682546936423529,0.693507386609672,0.690201607279505,0.663523183055296,0.667434236289776,0.670240222453820,0.669736826284214,0.675942023242957,0.665876483680596,0.664679689417315,0.667021676630678,0.659058494458087,0.653249895953469,0.662233199543616,0.665227270712478,0.660801130153199,0.664680089574121,0.678209736002275,0.684621441219490,0.693060123904281,0.701923060515158,0.705474853965742,0.697966561502941,0.701911621692313,0.701182498299048,0.723362356702818,0.721229011086888,0.711061140499516,0.693739440920560,0.702732351950322,0.695178262865104,0.711218756063916,0.720495049163712,0.728609047096228,0.727347751985644,0.726799219792453,0.704507590905802,0.711374406155866,0.719471128913653,0.721970928474361,0.703335023851252,0.681011409347442,0.668818444085303,0.665807778968479,0.668735678159270,0.679053449225068,0.681459301710227,0.710744409569896,0.700315232980094,0.711788989347150,0.710092627790148,0.721228307617814,0.742410810078695,0.769849763821056,0.785131888536707,0.788288376833129,0.797531546331289,0.793665647848403,0.782619640441357,0.781749596002704,0.771924439531600,0.775894389081924,0.785537166904365,0.769435896627199,0.770528464480776,0.749575051228339,0.739998981754510,0.740110914274151,0.730240901625845,0.725071351233752];
lenhurst = numel(Hurst);
lenhurst_original = numel(Hurst_original);
if lenhurst ~= lenhurst_original
    msgbox('多日移动Hurst指数序列返回长度有误','警告','信息对话框图标');
    return;
end
for i = 1:lenhurst
    if Hurst(i) - Hurst_original(i)>0.01
       msgbox('多日移动Hurst指数序列中计算数值有误','警告','信息对话框图标'); 
       return;
    end
end
 msgbox('Hurst_Exponent_Log_whole文件核对无误！','警告','信息对话框图标'); 
 
%以下部分检验Hurst_strategy_new文件
d1 = '2014-08-24'; 
d2 = '2015-08-21';  
index = '399001.SZ';  
period1 = 240;   
p=230;

[buy,sell,in1,time] = Hurst_strategy_new(d1,d2,index,period1,p);
len = size(buy,2);

buy_original = {735858.406250000,735867.468750000,735962.614583333,736004.468750000,736090.583333333,736133.458333333,736141.458333333,736187.406250000;8100.67750000000,8120.11810000000,10692.2837000000,10908.3588000000,14355.5297000000,17227.9548000000,14850.7778000000,13305.2236000000};
len_original = size(buy_original,2);

if len~=len_original
    msgbox('序列长度不一致，Hurst_strategy_new已改动','警告','信息对话框图标');
    return;
end

for i=1:2
    for j=1:len_original
        if buy{i,j} - buy_original{i,j}>0.01
           msgbox('序列数据不符，Hurst_strategy_new已改动','警告','信息对话框图标'); 
           return;
        end
    end
end
 msgbox('Hurst_strategy_new文件核对无误！','警告','信息对话框图标'); 
 
%以下部分检验retraceratio文件
testdata = [20 30 70 50 30 40 50 10 20 15];
[maxpercent,maxpoint] = retraceratio(testdata);
 
if maxpercent-0.8571>0.001
    msgbox('retraceratio文件中计算最大回撤率（maxpercent)有误!','警告','信息对话框图标');
    return;
end

if maxpoint~=8
    msgbox('retraceratio文件中计算最大回撤发生未知（maxpoint)有误!','警告','信息对话框图标');
    return;
end
msgbox('retraceratio文件核对无误!','警告','信息对话框图标');
